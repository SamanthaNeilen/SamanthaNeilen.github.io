<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Samantha Neilen</title>
    <meta name="description" content="My name is Samantha Neilen, a dutch .NET developer. I have been coding professionaly since 2008. On this blog I will be writing about multiple subjects that ...">
    <link rel="stylesheet" href="/assets/css/syntax.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />
    <link rel="stylesheet" href="/assets/css/site.css" />
    <link rel="canonical" href="https://samanthaneilen.github.io/">
    <link rel="alternate" type="application/rss+xml" title="Samantha Neilen" href="/feed.xml">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
    <header aria-label="header" class="header">
        <span class="header-text">Samantha Neilen</span>
    </header>
</div>
        <div class="row">
            <div class="col-md-7 col-md-offset-1">
                <main class="page-content" aria-label="content">
                    <div>
    
    
    
    <article>
        <header class="article-header">
            <a href="/2020/05/04/Calling-async-methods-with-configureawait.html">Calling async methods with ConfigureAwait</a>
        </header>
        
        <span>May 4, 2020</span> <br />
        Tags: 
        Async
        
        <div class="article-content">
            <p>When I started using SonarQube/SonarLint to improve code quality it made me aware of using the ConfigureAwait method available on any async method call. The linting rule defines:</p>

<blockquote>
  <p>After an <code class="highlighter-rouge">await</code>ed <code class="highlighter-rouge">Task</code> has executed, you can continue execution in the original, calling thread or any arbitrary thread. Unless the rest of the code needs the context from which the <code class="highlighter-rouge">Task</code> was spawned, <code class="highlighter-rouge">Task.ConfigureAwait(false)</code> should be used to keep execution in the <code class="highlighter-rouge">Task</code> thread to avoid the need for context switching and the possibility of deadlocks.</p>

  <p>This rule raises an issue when code in a class library <code class="highlighter-rouge">await</code>s a <code class="highlighter-rouge">Task</code> and continues execution in the original calling thread.</p>

  <p><a href="https://rules.sonarsource.com/csharp/RSPEC-3216">quoted from: sonarsource.com</a></p>
</blockquote>

<p>In this post, I will take little dive into asynchronous programming and refer to relevant resources to look at. After that, I will explain the usage of the ConfigureAwait method.</p>

<p><strong>Table of contents:</strong></p>
<ul id="markdown-toc">
  <li><a href="#what-is-asynchronous-programming" id="markdown-toc-what-is-asynchronous-programming">What is asynchronous programming</a></li>
  <li><a href="#the-task-based-asynchronous-pattern-tap" id="markdown-toc-the-task-based-asynchronous-pattern-tap">The Task-based Asynchronous Pattern (TAP)</a></li>
  <li><a href="#using-configureawait" id="markdown-toc-using-configureawait">Using ConfigureAwait</a></li>
</ul>

<h3 id="what-is-asynchronous-programming">What is asynchronous programming</h3>

<p>If you are not very familiar with asynchronous programming I would advise you to look into the high-level explanations found in the Microsoft Docs articles below.</p>

<ul>
  <li><a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/">Asynchronous programming with async and await</a></li>
  <li><a href="https://docs.microsoft.com/en-us/dotnet/standard/async-in-depth">Async in depth</a></li>
</ul>

<p>My summary for these articles is:</p>

<p>A single method call chain in your program when called synchronously is executed on 1 thread. If the code has to wait for an external call handled by the operating system (accessing a disk or network resource) that single thread will stay idle and wait for that external call to finish then resume its work.</p>

<p>When using asynchronous programming you allow the call chain execution to be paused and free up the thread for other work while waiting for the response of an external or long-running call. This allows the software or system that runs the software to complete more work and utilize it’s resources more efficiently.</p>

<p>Another great article on Microsoft Docs is “https://docs.microsoft.com/en-us/dotnet/csharp/async” that explains how to identify situations in which asynchronous programming is especially helpful. Also, be aware of the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/async#important-info-and-advice">“Important info and advice</a>” section in that article for some extra tips even if you already know and use asynchronous programming.</p>

<h3 id="the-task-based-asynchronous-pattern-tap">The Task-based Asynchronous Pattern (TAP)</h3>

<p>.NET Framework 4 and above (including .NET Core) use the Task-based Asynchronous Pattern (TAP) for writing asynchronous code. There <a href="https://docs.microsoft.com/en-us/dotnet/standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap">are in-depth and concrete articles for Task-based asynchronous pattern (TAP)</a> on how to use the Task-based Asynchronous Pattern in C#. You can also find explanations on the “Legacy” asynchronous patterns used in the .NET framework using the left-hand content menu.</p>

<p>The “<a href="https://docs.microsoft.com/en-us/dotnet/standard/asynchronous-programming-patterns/consuming-the-task-based-asynchronous-pattern">Consuming the Task-based Asynchronous Pattern</a>” contains an explanation on how to consume asynchronous methods. This information is good to know as more and more methods of the .NET framework are starting to become asynchronous methods. This article also contains <a href="https://docs.microsoft.com/en-us/dotnet/standard/asynchronous-programming-patterns/consuming-the-task-based-asynchronous-pattern#configuring-suspension-and-resumption-with-yield-and-configureawait">an explanation for the ConfigureAwait method</a>.</p>

<h3 id="using-configureawait">Using ConfigureAwait</h3>

<p>As stated in the last paragraph the section in “<a href="https://docs.microsoft.com/en-us/dotnet/standard/asynchronous-programming-patterns/consuming-the-task-based-asynchronous-pattern">Consuming the Task-based Asynchronous Pattern</a>” explaining the ConfigureAwait is “<a href="https://docs.microsoft.com/en-us/dotnet/standard/asynchronous-programming-patterns/consuming-the-task-based-asynchronous-pattern#configuring-suspension-and-resumption-with-yield-and-configureawait">Configuring Suspension and Resumption with Yield and ConfigureAwait</a>”.</p>

<p>It explains that when resuming work after an await, the default behavior is to resume work on the original thread that was paused. If you do not explicitly use the ConfigureAwait method the default behavior will be the same as ConfigureAwait(true).</p>

<p>When using asynchronous methods in a web application this default behavior allows you to retain the value certain variables like for example the HttpContext variable after an awaited method.</p>

<p>If you have no need for these values (or capture all the values on entry and hand them off to your asynchronous code) you can use ConfigureAwait(false). This will allow the continuation of execution on any thread and allows the system to improve its scheduling of work on the available threads. As stated in the SonarQube rule listed at the start of the article this may also prevent certain deadlock scenarios.</p>

<p>However, be aware that when introducing ConfigureAwait(false) that you may lose some context variables and get some unexplainable null reference exceptions if the code is expecting those variables to still have a value.</p>

<p>There is a great <a href="https://devblogs.microsoft.com/dotnet/configureawait-faq/">Microsoft developer blogpost</a> with extra useful information and a FAQ section about the usage of ConfigureAwait. It has a more in-depth explanation of how to use ConfigureAwait.</p>

        </div>
    </article>
    
    <article>
        <header class="article-header">
            <a href="/2020/03/18/Tips-for-building-habits-around-working-from-home.html">Tips for building habits around working from home</a>
        </header>
        
        <span>Mar 18, 2020</span> <br />
        Tags: 
        <div class="article-content">
            <p>What helps me stay focused when working from home is keeping the same schedule (and thus my habits around that schedule) and building the mental model of “working time” and “home time”. Just a disclaimer: I don’t have kids or pets that don’t understand and will probably disrupt these habits and mental models.</p>

<p>For me this means:</p>

<ul>
  <li>Waking up at 5-6 am to get an hour of study before I would regularly leave for work.</li>
  <li>Instead of leaving for work simulate my commute by exercising for half an hour. Preferably a walk outside</li>
  <li>Have a fixed working space in the house to get in the mindset that being there is being “at work”</li>
  <li>Start working at your regular staring time</li>
  <li>Keep the same eating, drinking and break habits you would have in the office (for my this is regulating my caffeine and not over caffeinating, have just my regular sandwich and apple for lunch at my desk followed by a half-hour exercise moment)</li>
  <li>Don’t overeat or crash on the couch in front of the television during lunch to keep fit and motivated for the afternoon.</li>
  <li>Try not to do any chores during “work hours” to keep that in-office mindset</li>
  <li>Stop working at the same time you regularly leave for home (working long hours will probably make you less effective and burn you out in the long run)</li>
  <li>Go to bed a the same time as you would on a regular working day</li>
</ul>

<p>Some recent podcasts about the same subject for more tips and stories</p>

<ul>
  <li><a href="https://spec.fm/podcasts/developer-tea/317916">Developer tea - Hidden Environment Inputs - Mindful Remote Work</a>  (be sure to check out the other episodes for this podcast. It’s a treasure trove on episodes about habit building and mindfulness in your work)</li>
  <li><a href="https://hanselminutes.com/723/surviving-as-a-remote-tech-employee-with-jayson">Hanselminutes - Surviving as a remote tech employee with Jayson J. Phillips</a></li>
  <li><a href="https://ladybug.dev/working-remotely">Ladybug podcast – working remotely</a></li>
</ul>


        </div>
    </article>
    
    <article>
        <header class="article-header">
            <a href="/2020/02/08/Unit-testing-self-executing-JavaScript-Modules-in-Visual-Studio.html">Unit testing self-executing JavaScript modules in Visual Studio</a>
        </header>
        
        <span>Feb 8, 2020</span> <br />
        Tags: 
        JavaScript
        
        TestAutomation
        
        <div class="article-content">
            <p>Visual Studio has support for unit tests in the Test Explorer window so you can run all your C# and JavaScript tests from that editor. A separate Node project can contain al the test code separate from the code that gets published and deployed. It is possible to include the tests in the web project itself. See <a href="https://docs.microsoft.com/en-us/visualstudio/javascript/unit-testing-javascript-with-visual-studio?view=vs-2019#unit-tests-in-other-project-types">the Microsoft Docs page on Unit testing JavaScript and TypeScript in Visual Studio</a> for more details.</p>

<p>This post is a continuation of my post about <a href="https://samanthaneilen.github.io/2019/12/30/Creating-more-maintainable-javascript-with-self-executing-functions.html">Creating more maintainable JavaScript with self-executing functions</a>. I will continue building on the JavaScriptModules project presented in that post. A working Visual Studio project with the code can be found in my <a href="https://github.com/SamanthaNeilen/JavascriptModulesExamples">JavaScriptModuleExamples repository on GitHub</a>.
 If you use the project from GitHub be sure to follow to ReadMe.md on the repository for additional steps to see the tests in Visual Studio Test Explorer.</p>

<p>The befits of writing these JavaScript unit tests are getting earlier feedback about the state of your JavaScript without writing more fragile and slower integration tests. The unit tests can also be run in the build pipeline next to your regular unit tests using an npm test command step before deploying to an environment.</p>

<p><strong>Table of contents:</strong></p>
<ul id="markdown-toc">
  <li><a href="#setup-a-nodejs-test-project" id="markdown-toc-setup-a-nodejs-test-project">Setup a Node.Js Test project</a></li>
  <li><a href="#writing-tests" id="markdown-toc-writing-tests">Writing tests</a></li>
  <li><a href="#resources" id="markdown-toc-resources">Resources</a></li>
</ul>

<h3 id="setup-a-nodejs-test-project">Setup a Node.Js Test project</h3>

<p>So to start testing, add a Blank Node.js Console Application project. You need to have the Node.js workload installed in Visual Studio. When you add a new file to the project via the “Add -&gt; New Item” context menu, you can see the test frameworks that Visual Studio already provides a template file for. The template file contains a passing test and a failing test showing the syntax for basic tests.</p>

<p><img src="/assets/images/20200208/JavaScriptUnitTestFileTemplates.png" alt="[JavaScript unit test file templates]" /></p>

<p><a href="https://medium.com/welldone-software/an-overview-of-javascript-testing-in-2019-264e19514d0a">An article comparing several of the different JavaScript frameworks can be found on Medium.</a></p>

<p>I will be working with the Jest framework in this post, so add a Jest test file. The contents for the default new Jest file is shown below.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="s1">'Test Suite 1'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">it</span><span class="p">(</span><span class="s2">"Test 1 - This shouldn't fail"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">toBeTruthy</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s1">'Test 2 - This should fail'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="mi">1</span> <span class="o">===</span> <span class="mi">1</span><span class="p">).</span><span class="nx">toBeTruthy</span><span class="p">();</span> <span class="c1">// "This shouldn't fail"</span>
        <span class="nx">expect</span><span class="p">(</span><span class="kc">false</span><span class="p">).</span><span class="nx">toBeTruthy</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>To run the tests using Visual Studio Test you need to set the “JavaScript Unit Test” properties in the project properties and install the jest and jest-editor-support npm packages.</p>

<p>For the “JavaScript Unit Tests” properties set the “Test Framework” to the framework of choice (Jest, in my case) and set the Test Root to a “Tests” subfolder. Using a subfolder will ensure that you can add extra folders with builder and helper classes without them being seen as potential unit test files.</p>

<p>Now the tests will show up in Test Explorer after building the project. You may have to restart Visual Studio the first time before any tests show up. Also to ensure running or debugging the latest version of your tests you always need to build before running a test via Test Explorer.</p>

<p><img src="/assets/images/20200208/FirstTestsLoadedInTestExplorer.png" alt="[First tests loaded in Test Explorer]" /></p>

<h3 id="writing-tests">Writing tests</h3>

<p>To start testing the customer-overview.js file from the JavaScriptModules web project we first have to hookup some dependencies and mocks. We need jQuery, a mock of our customer-service.js and the HTML or DOM setup that the module can interact with.</p>

<p>First, add a testutilities.js file that will set up a module that has the link to the wwwroot of our project under test and loads in 3rd party libraries needed for testing. The module is shown below.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">currentModule</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">let</span> <span class="nx">wwwRootScriptsFolder</span> <span class="o">=</span> <span class="s1">'../JavaScriptModules/wwwroot/'</span><span class="p">;</span>

    <span class="nx">currentModule</span><span class="p">.</span><span class="nx">wwwRoot</span> <span class="o">=</span> <span class="nx">wwwRootScriptsFolder</span><span class="p">;</span>

    <span class="nx">currentModule</span><span class="p">.</span><span class="nx">initialize</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nb">global</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">=</span> <span class="nb">global</span><span class="p">.</span><span class="nx">$</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">wwwRootScriptsFolder</span> <span class="o">+</span> <span class="s1">'lib/jquery/jquery.js'</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nb">global</span><span class="p">.</span><span class="nx">TestUtilitiesModule</span> <span class="o">=</span> <span class="nx">currentModule</span><span class="p">;</span>
<span class="p">})();</span>
</code></pre></div></div>

<p>Now we can use the TestUtilities module in the test file to do a simple test using jQuery. This example also shows how to declare some HTML to interact with. The document is actually a mock provided by the test framework. Any interactions your code and modules have with the window or document will work as expected.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="s1">'Test Suite 1'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">jest</span><span class="p">.</span><span class="nx">resetModules</span><span class="p">();</span>
        <span class="nx">require</span><span class="p">(</span><span class="s1">'../TestUtilities.js'</span><span class="p">);</span>
        <span class="nb">global</span><span class="p">.</span><span class="nx">TestUtilitiesModule</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>

        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'label'</span><span class="p">);</span>
        <span class="nx">input</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">'myLabel'</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s2">"Test 1 - This shouldn't fail"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">'#myLabel'</span><span class="p">)).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s1">'Test 2 - This should fail'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="mi">1</span> <span class="o">===</span> <span class="mi">1</span><span class="p">).</span><span class="nx">toBeTruthy</span><span class="p">();</span> <span class="c1">// "This shouldn't fail"</span>
        <span class="nx">expect</span><span class="p">(</span><span class="kc">false</span><span class="p">).</span><span class="nx">toBeTruthy</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">});</span>

</code></pre></div></div>
<p>If you run the test in debugging mode, you can stop and inspect the variables and DOM.</p>

<p><img src="/assets/images/20200208/DebugTest.png" alt="[Debugging JavaScript test]" /></p>

<p>Now, we want to build the HTML template for the initial page for the module under test. I usually create a module using <a href="https://en.wikipedia.org/wiki/Builder_pattern">the builder pattern</a> to be able to create the template in a fluent syntax. This way you can use the builder in your tests to create multiple starting HTML situations with expressive and readable syntax. The builder and the test file using the builder are shown below. Not that in the builder below I only add the required elements to check my logic. All elements that are for layout and not functionality are omitted. (The code below can be also be found in my GitHub repo under the tag: V1.3-first-test-module-using-HTML-builder <a href="https://github.com/SamanthaNeilen/JavascriptModulesExamples/tree/V1.3-first-test-module-using-HTML-builder">my GitHub repo under the tag: V1.3-first-test-module-using-HTML-builder</a>.)</p>

<p>(Also note that the code shown is a refinement of multiple times writing, evaluating, refactoring and running and reading the tests iterations. If your logic and HTML are simple you may not even these builders to write a few simple tests.)</p>

<p>UnitTest.js:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="s1">'Search using Name'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">testProjectRoot</span> <span class="o">=</span> <span class="s1">'../../../'</span><span class="p">;</span>
        <span class="nx">jest</span><span class="p">.</span><span class="nx">resetModules</span><span class="p">();</span>

        <span class="nx">require</span><span class="p">(</span><span class="nx">testProjectRoot</span> <span class="o">+</span> <span class="s1">'TestUtilities.js'</span><span class="p">);</span>
        <span class="nb">global</span><span class="p">.</span><span class="nx">TestUtilitiesModule</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
        <span class="nx">require</span><span class="p">(</span><span class="nx">testProjectRoot</span> <span class="o">+</span> <span class="s1">'Builders/CustomerOverviewHtmlBuilder.js'</span><span class="p">);</span>

        <span class="kd">let</span> <span class="nx">wwwRoot</span> <span class="o">=</span> <span class="nx">testProjectRoot</span> <span class="o">+</span> <span class="nb">global</span><span class="p">.</span><span class="nx">TestUtilitiesModule</span><span class="p">.</span><span class="nx">wwwRoot</span><span class="p">;</span>
        <span class="nx">require</span><span class="p">(</span><span class="nx">wwwRoot</span> <span class="o">+</span> <span class="s1">'js/utilities.js'</span><span class="p">);</span>
        <span class="nx">require</span><span class="p">(</span><span class="nx">wwwRoot</span> <span class="o">+</span> <span class="s1">'js/customer-overview.js'</span><span class="p">);</span>

        <span class="c1">//arrange initial state</span>
        <span class="kd">let</span> <span class="nx">htmlTemplate</span> <span class="o">=</span> <span class="nb">global</span><span class="p">.</span><span class="nx">customerOverviewHtmlBuilderModule</span>
            <span class="p">.</span><span class="k">new</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">clearDataRows</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">hideLoadingRow</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">withDataRow</span><span class="p">(</span><span class="s1">'first customer'</span><span class="p">,</span> <span class="s1">'first customer email'</span><span class="p">,</span> <span class="s1">'first customer country'</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">withDataRow</span><span class="p">(</span><span class="s1">'second customer'</span><span class="p">,</span> <span class="s1">'second customer email'</span><span class="p">,</span> <span class="s1">'second customer country'</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">withDataRow</span><span class="p">(</span><span class="s1">'testcustomer'</span><span class="p">,</span> <span class="s1">'testcustomer email'</span><span class="p">,</span> <span class="s1">'testcustomer country'</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">build</span><span class="p">();</span>

        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">htmlTemplate</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s2">"WHEN 3 rows loaded THEN Search with full Name SHOULD filter to show one row"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">//arrange</span>
        <span class="kd">let</span> <span class="nx">searchNameValue</span> <span class="o">=</span> <span class="s1">'second customer'</span><span class="p">;</span>
        <span class="kd">let</span> <span class="nx">initialVisibleRows</span> <span class="o">=</span> <span class="nx">getVisibleRows</span><span class="p">();</span>
        <span class="kd">let</span> <span class="nx">initialInvisibleRows</span> <span class="o">=</span> <span class="nx">getInvisibleRows</span><span class="p">();</span>

        <span class="c1">//act</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">"#searchCustomerName"</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">searchNameValue</span><span class="p">);</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">customerOverviewModule</span><span class="p">.</span><span class="nx">filterData</span><span class="p">();</span>

        <span class="c1">//assert intial state</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">initialVisibleRows</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">initialInvisibleRows</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

        <span class="c1">//assert state after action</span>
        <span class="kd">let</span> <span class="nx">filteredVisibleRows</span> <span class="o">=</span> <span class="nx">getVisibleRows</span><span class="p">();</span>
        <span class="kd">let</span> <span class="nx">filteredInvisibleRows</span> <span class="o">=</span> <span class="nx">getInvisibleRows</span><span class="p">();</span>
        
        <span class="nx">expect</span><span class="p">(</span><span class="nx">filteredVisibleRows</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">filteredInvisibleRows</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

        <span class="kd">let</span> <span class="nx">actualVisibleRowSearchName</span> <span class="o">=</span> <span class="nx">getSearchNameValueForSingleRow</span><span class="p">(</span><span class="nx">filteredVisibleRows</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">actualVisibleRowSearchName</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">searchNameValue</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="kd">function</span> <span class="nx">getSearchNameValueForSingleRow</span><span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">row</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'td'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">getVisibleRows</span><span class="p">()</span> <span class="p">{</span>
        
        <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">grep</span><span class="p">(</span><span class="nx">getAllRows</span><span class="p">(),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="nx">$</span><span class="p">(</span><span class="nx">row</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">'display-none'</span><span class="p">);</span> <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">getInvisibleRows</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">grep</span><span class="p">(</span><span class="nx">getAllRows</span><span class="p">(),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">row</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">'display-none'</span><span class="p">);</span> <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">getAllRows</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#customer-table-body'</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'tr'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

</code></pre></div></div>

<p>TestUtilities.js:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">currentModule</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">let</span> <span class="nx">wwwRootScriptsFolder</span> <span class="o">=</span> <span class="s1">'../JavaScriptModules/wwwroot/'</span><span class="p">;</span>

    <span class="nx">currentModule</span><span class="p">.</span><span class="nx">wwwRoot</span> <span class="o">=</span> <span class="nx">wwwRootScriptsFolder</span><span class="p">;</span>

    <span class="nx">currentModule</span><span class="p">.</span><span class="nx">initialize</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nb">global</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">=</span> <span class="nb">global</span><span class="p">.</span><span class="nx">$</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">wwwRootScriptsFolder</span> <span class="o">+</span> <span class="s1">'lib/jquery/jquery.js'</span><span class="p">);</span>
        <span class="nx">require</span><span class="p">(</span><span class="s1">'./Builders/BaseHtmlBuilder.js'</span><span class="p">);</span>
    <span class="p">};</span>
    
    <span class="nb">global</span><span class="p">.</span><span class="nx">TestUtilitiesModule</span> <span class="o">=</span> <span class="nx">currentModule</span><span class="p">;</span>
<span class="p">})();</span>
</code></pre></div></div>

<p>CustomerOverviewHtmlBuilder.js:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">baseHtmlBuilder</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">currentModule</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">let</span> <span class="nx">root</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'div'</span><span class="p">);</span>

    <span class="nx">currentModule</span><span class="p">.</span><span class="k">new</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">root</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'div'</span><span class="p">);</span>

        <span class="kd">let</span> <span class="nx">searchForm</span> <span class="o">=</span> <span class="nx">createSearchForm</span><span class="p">();</span>
        <span class="nx">root</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">searchForm</span><span class="p">);</span>

        <span class="kd">let</span> <span class="nx">dataGrid</span> <span class="o">=</span> <span class="nx">createEmptyGrid</span><span class="p">();</span>
        <span class="nx">root</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">dataGrid</span><span class="p">);</span>

        <span class="kd">let</span> <span class="nx">rowTemplates</span> <span class="o">=</span> <span class="nx">createRowTemplates</span><span class="p">();</span>
        <span class="nx">root</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">rowTemplates</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">currentModule</span><span class="p">;</span>
    <span class="p">};</span>


    <span class="nx">currentModule</span><span class="p">.</span><span class="nx">clearDataRows</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">customerTable</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">root</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'#customer-table-body'</span><span class="p">);</span>
        <span class="kd">let</span> <span class="nx">loadingRow</span> <span class="o">=</span> <span class="nx">customerTable</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.loading-row'</span><span class="p">);</span>
        <span class="nx">customerTable</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
        <span class="nx">customerTable</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">loadingRow</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">currentModule</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">currentModule</span><span class="p">.</span><span class="nx">hideLoadingRow</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">customerTable</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">root</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'#customer-table-body'</span><span class="p">);</span>
        <span class="kd">let</span> <span class="nx">loadingRow</span> <span class="o">=</span> <span class="nx">customerTable</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.loading-row'</span><span class="p">);</span>
        <span class="nx">loadingRow</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">'display-none'</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">currentModule</span><span class="p">;</span>
    <span class="p">};</span>
    
    <span class="nx">currentModule</span><span class="p">.</span><span class="nx">withDataRow</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">country</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">customerTable</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">root</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'#customer-table-body'</span><span class="p">);</span>
        <span class="kd">let</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">baseHtmlBuilder</span><span class="p">.</span><span class="nx">createRow</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="na">Id</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
                <span class="na">className</span><span class="p">:</span> <span class="s1">'customer-row'</span><span class="p">,</span>
                <span class="na">cells</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span> <span class="na">innerHTML</span><span class="p">:</span> <span class="nx">name</span> <span class="p">},</span>
                    <span class="p">{</span> <span class="na">innerHTML</span><span class="p">:</span> <span class="nx">email</span> <span class="p">},</span>
                    <span class="p">{</span> <span class="na">innerHTML</span><span class="p">:</span> <span class="nx">country</span> <span class="p">}]</span>
            <span class="p">}</span>
        <span class="p">);</span>
        <span class="nx">customerTable</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">currentModule</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">currentModule</span><span class="p">.</span><span class="nx">build</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">root</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">createSearchForm</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">searchform</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'div'</span><span class="p">);</span>
        <span class="nx">searchform</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">'search-customer'</span><span class="p">;</span>

        <span class="nx">searchform</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">baseHtmlBuilder</span><span class="p">.</span><span class="nx">createTextInput</span><span class="p">(</span><span class="s1">'searchCustomerName'</span><span class="p">));</span>
        <span class="nx">searchform</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">baseHtmlBuilder</span><span class="p">.</span><span class="nx">createTextInput</span><span class="p">(</span><span class="s1">'searchEmail'</span><span class="p">));</span>
        <span class="nx">searchform</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">baseHtmlBuilder</span><span class="p">.</span><span class="nx">createTextInput</span><span class="p">(</span><span class="s1">'searchCountry'</span><span class="p">));</span>
        <span class="nx">searchform</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">baseHtmlBuilder</span><span class="p">.</span><span class="nx">createButton</span><span class="p">(</span><span class="s1">'customerOverviewSearchButton'</span><span class="p">));</span>

        <span class="k">return</span> <span class="nx">searchform</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">createEmptyGrid</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">table</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'table'</span><span class="p">);</span>

        <span class="kd">let</span> <span class="nx">tableBody</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'tbody'</span><span class="p">);</span>
        <span class="nx">tableBody</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">'customer-table-body'</span><span class="p">;</span>
        <span class="nx">table</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">tableBody</span><span class="p">);</span>

        <span class="kd">let</span> <span class="nx">row</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'tr'</span><span class="p">);</span>
        <span class="nx">row</span><span class="p">.</span><span class="nx">className</span>  <span class="o">=</span> <span class="s1">'loading-row'</span><span class="p">;</span>
        <span class="nx">tableBody</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">table</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">createRowTemplates</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">table</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'table'</span><span class="p">);</span>
        <span class="nx">table</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">'display-none'</span><span class="p">;</span>

        <span class="kd">let</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">baseHtmlBuilder</span><span class="p">.</span><span class="nx">createRow</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="na">id</span><span class="p">:</span> <span class="s1">'data-row-template'</span><span class="p">,</span>
                <span class="na">className</span><span class="p">:</span> <span class="s1">'customer-row'</span><span class="p">,</span>
                <span class="na">cells</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span> <span class="na">innerHTML</span><span class="p">:</span> <span class="s1">''</span> <span class="p">},</span>
                    <span class="p">{</span> <span class="na">innerHTML</span><span class="p">:</span> <span class="s1">''</span> <span class="p">},</span>
                    <span class="p">{</span> <span class="na">innerHTML</span><span class="p">:</span> <span class="s1">''</span> <span class="p">}]</span>
            <span class="p">}</span>
        <span class="p">);</span>
        <span class="nx">table</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
        
        <span class="k">return</span> <span class="nx">table</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nb">global</span><span class="p">.</span><span class="nx">customerOverviewHtmlBuilderModule</span> <span class="o">=</span> <span class="nx">currentModule</span><span class="p">;</span>
<span class="p">})(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nb">global</span><span class="p">.</span><span class="nx">BaseHtmlBuilderModule</span><span class="p">);</span>
</code></pre></div></div>
<p>BaseHtmlBuilder.js:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">currentModule</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">currentModule</span><span class="p">.</span><span class="nx">createTextInput</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'input'</span><span class="p">);</span>
        <span class="nx">input</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
        <span class="nx">input</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">'text'</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">input</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">currentModule</span><span class="p">.</span><span class="nx">createButton</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'button'</span><span class="p">);</span>
        <span class="nx">button</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
        <span class="nx">button</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">'button'</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">button</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">currentModule</span><span class="p">.</span><span class="nx">createRow</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rowDefinition</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">rowElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'tr'</span><span class="p">);</span>
        <span class="nx">rowElement</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">rowDefinition</span><span class="p">.</span><span class="nx">Id</span><span class="p">;</span>
        <span class="nx">rowElement</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">rowDefinition</span><span class="p">.</span><span class="nx">className</span><span class="p">;</span>

        <span class="kd">let</span> <span class="nx">cells</span> <span class="o">=</span> <span class="nx">currentModule</span><span class="p">.</span><span class="nx">createCells</span><span class="p">(</span><span class="nx">rowDefinition</span><span class="p">.</span><span class="nx">cells</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">cells</span><span class="p">,</span>
            <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">cell</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">rowElement</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">cell</span><span class="p">);</span>
            <span class="p">});</span>

        <span class="k">return</span> <span class="nx">rowElement</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">currentModule</span><span class="p">.</span><span class="nx">createCells</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">cells</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">resultingCells</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">cells</span><span class="p">,</span>
            <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">cell</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">cellElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'td'</span><span class="p">);</span>
                <span class="nx">cellElement</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">className</span><span class="p">;</span>
                <span class="nx">cellElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
                <span class="nx">resultingCells</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">cellElement</span><span class="p">);</span>
            <span class="p">});</span>

        <span class="k">return</span> <span class="nx">resultingCells</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nb">global</span><span class="p">.</span><span class="nx">BaseHtmlBuilderModule</span> <span class="o">=</span> <span class="nx">currentModule</span><span class="p">;</span>
<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>
</code></pre></div></div>
<p>When you see this code it might seem like a lot of work to create a few tests. By extracting helper methods to a separate class you will have to invest a bit more initially but will be faster at writing tests later. Also by practicing TDD, you should be able to create the template as you are building your HTML and initial JavaScript methods so the extra invested time should not come all at once after completing your complete HTML and JavaScript logic.</p>

<p>A debugging/troubleshooting tip for your HTML builders. If you’re unsure that the code to create the HTML is correct. At a watch to the document.body.innerHTML variable and paste the value in a new HTML page file in Visual Studio. Select all contents in the file and right-click to get the context menu and select Un-Minify to get a nice readable HTML with syntax highlighting to troubleshoot the output of the builder.</p>

<p><img src="/assets/images/20200208/DocumentHtmlUnMinify.png" alt="[Un-Minify option for HTML]" /></p>

<p>Jest supports a way to use tests with parameters but the Visual Studio integration does not pick them up. So for now, I just add multiple tests for the different parameters I would like to test. To avoid having to change all the tests when my arrangements or assertions have to change, I introduce ScenarioBuilder and/or AssertionHelper modules that again abstract the test scenarios and assertions in a nice readable fluent syntax.</p>

<p>In the example, I added a scenario builder module in the file itself containing a full set of arrange, act and assert methods. If the module gets to large or you see duplication across several builders you could choose to create builders with better separation of concerns. The point is to show an example of a pattern for writing readable tests where the implementation details can be changed in a single spot in the code should the page or functionality change. For the full working solution see <a href="https://github.com/SamanthaNeilen/JavascriptModulesExamples/tree/V1.4-first-test-using-scenario-builder">my GitHub repo with the tag: V1.4-first-test-using-scenario-builder</a>.)</p>

<p>UnitTest.js</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="s1">'Search using Name'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="nx">it</span><span class="p">(</span><span class="s2">"WHEN 3 rows loaded THEN Search with full Name SHOULD filter to show one row"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">scenario</span> <span class="o">=</span> <span class="nb">global</span><span class="p">.</span><span class="nx">SearchCustomerNameScenarioBuilderModule</span><span class="p">.</span><span class="k">new</span><span class="p">();</span>

        <span class="c1">//arrange</span>
        <span class="kd">const</span> <span class="nx">valueToSearch</span> <span class="o">=</span> <span class="s1">'second customer'</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">expectedNumberOfVisibleRows</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">expectedNumberOfInvisibleRows</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        
        <span class="nx">scenario</span><span class="p">.</span><span class="nx">arrange_Page_With_3_Initial_DataRows</span><span class="p">();</span>

        <span class="c1">//act</span>
        <span class="nx">scenario</span><span class="p">.</span><span class="nx">act_SearchName</span><span class="p">(</span><span class="nx">valueToSearch</span><span class="p">);</span>

        <span class="c1">//assert</span>
        <span class="nx">scenario</span><span class="p">.</span><span class="nx">assert_Number_Of_Visible_Rows</span><span class="p">(</span><span class="nx">expectedNumberOfVisibleRows</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">assert_Number_Of_Invisible_Rows</span><span class="p">(</span><span class="nx">expectedNumberOfInvisibleRows</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">assert_Visible_Rows_Name_Is_Complete_SearchValue</span><span class="p">(</span><span class="nx">valueToSearch</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">assert_Invisible_Rows_Name_Do_Not_Contain_SearchValue</span><span class="p">(</span><span class="nx">valueToSearch</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s2">"WHEN 3 rows loaded THEN Search with partial Name SHOULD filter to show one row"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">scenario</span> <span class="o">=</span> <span class="nb">global</span><span class="p">.</span><span class="nx">SearchCustomerNameScenarioBuilderModule</span><span class="p">.</span><span class="k">new</span><span class="p">();</span>

        <span class="c1">//arrange</span>
        <span class="kd">const</span> <span class="nx">valueToSearch</span> <span class="o">=</span> <span class="s1">'test'</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">expectedNumberOfVisibleRows</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">expectedNumberOfInvisibleRows</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

        <span class="nx">scenario</span><span class="p">.</span><span class="nx">arrange_Page_With_3_Initial_DataRows</span><span class="p">();</span>

        <span class="c1">//act</span>
        <span class="nx">scenario</span><span class="p">.</span><span class="nx">act_SearchName</span><span class="p">(</span><span class="nx">valueToSearch</span><span class="p">);</span>

        <span class="c1">//assert</span>
        <span class="nx">scenario</span><span class="p">.</span><span class="nx">assert_Number_Of_Visible_Rows</span><span class="p">(</span><span class="nx">expectedNumberOfVisibleRows</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">assert_Number_Of_Invisible_Rows</span><span class="p">(</span><span class="nx">expectedNumberOfInvisibleRows</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">assert_Visible_Rows_Name_Contains_SearchValue</span><span class="p">(</span><span class="nx">valueToSearch</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">assert_Invisible_Rows_Name_Do_Not_Contain_SearchValue</span><span class="p">(</span><span class="nx">valueToSearch</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s2">"WHEN 3 rows loaded THEN Search with empty Name SHOULD filter to show all rows"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">scenario</span> <span class="o">=</span> <span class="nb">global</span><span class="p">.</span><span class="nx">SearchCustomerNameScenarioBuilderModule</span><span class="p">.</span><span class="k">new</span><span class="p">();</span>

        <span class="c1">//arrange</span>
        <span class="kd">const</span> <span class="nx">valueToSearch</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">expectedNumberOfVisibleRows</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">expectedNumberOfInvisibleRows</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="nx">scenario</span><span class="p">.</span><span class="nx">arrange_Page_With_3_Initial_DataRows</span><span class="p">();</span>

        <span class="c1">//act</span>
        <span class="nx">scenario</span><span class="p">.</span><span class="nx">act_SearchName</span><span class="p">(</span><span class="nx">valueToSearch</span><span class="p">);</span>

        <span class="c1">//assert</span>
        <span class="nx">scenario</span><span class="p">.</span><span class="nx">assert_Number_Of_Visible_Rows</span><span class="p">(</span><span class="nx">expectedNumberOfVisibleRows</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">assert_Number_Of_Invisible_Rows</span><span class="p">(</span><span class="nx">expectedNumberOfInvisibleRows</span><span class="p">);</span>
    <span class="p">});</span>


    <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">jest</span><span class="p">,</span> <span class="nx">expect</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">currentModule</span> <span class="o">=</span> <span class="p">{};</span>

        <span class="nx">currentModule</span><span class="p">.</span><span class="k">new</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">testProjectRoot</span> <span class="o">=</span> <span class="s1">'../../../'</span><span class="p">;</span>
            <span class="nx">jest</span><span class="p">.</span><span class="nx">resetModules</span><span class="p">();</span>

            <span class="nx">require</span><span class="p">(</span><span class="nx">testProjectRoot</span> <span class="o">+</span> <span class="s1">'TestUtilities.js'</span><span class="p">);</span>
            <span class="nb">global</span><span class="p">.</span><span class="nx">TestUtilitiesModule</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
            <span class="nx">require</span><span class="p">(</span><span class="nx">testProjectRoot</span> <span class="o">+</span> <span class="s1">'Builders/CustomerOverviewHtmlBuilder.js'</span><span class="p">);</span>

            <span class="kd">let</span> <span class="nx">wwwRoot</span> <span class="o">=</span> <span class="nx">testProjectRoot</span> <span class="o">+</span> <span class="nb">global</span><span class="p">.</span><span class="nx">TestUtilitiesModule</span><span class="p">.</span><span class="nx">wwwRoot</span><span class="p">;</span>
            <span class="nx">require</span><span class="p">(</span><span class="nx">wwwRoot</span> <span class="o">+</span> <span class="s1">'js/utilities.js'</span><span class="p">);</span>
            <span class="nx">require</span><span class="p">(</span><span class="nx">wwwRoot</span> <span class="o">+</span> <span class="s1">'js/customer-overview.js'</span><span class="p">);</span>

            <span class="k">return</span> <span class="nx">currentModule</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="nx">currentModule</span><span class="p">.</span><span class="nx">arrange_Page_With_3_Initial_DataRows</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>

            <span class="kd">const</span> <span class="nx">template</span> <span class="o">=</span> <span class="nb">global</span><span class="p">.</span><span class="nx">customerOverviewHtmlBuilderModule</span>
                <span class="p">.</span><span class="k">new</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">clearDataRows</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">hideLoadingRow</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">withDataRow</span><span class="p">(</span><span class="s1">'first customer'</span><span class="p">,</span> <span class="s1">'first customer email'</span><span class="p">,</span> <span class="s1">'first customer country'</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">withDataRow</span><span class="p">(</span><span class="s1">'second customer'</span><span class="p">,</span> <span class="s1">'second customer email'</span><span class="p">,</span> <span class="s1">'second customer country'</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">withDataRow</span><span class="p">(</span><span class="s1">'testcustomer'</span><span class="p">,</span> <span class="s1">'testcustomer email'</span><span class="p">,</span> <span class="s1">'testcustomer country'</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">build</span><span class="p">();</span>

            <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">template</span><span class="p">);</span>

            <span class="k">return</span> <span class="nx">currentModule</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="nx">currentModule</span><span class="p">.</span><span class="nx">act_SearchName</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">nameToSearch</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">"#searchCustomerName"</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">nameToSearch</span><span class="p">);</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">customerOverviewModule</span><span class="p">.</span><span class="nx">filterData</span><span class="p">();</span>

            <span class="k">return</span> <span class="nx">currentModule</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="nx">currentModule</span><span class="p">.</span><span class="nx">assert_Number_Of_Visible_Rows</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">numberOfRows</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">getVisibleRows</span><span class="p">()).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="nx">numberOfRows</span><span class="p">);</span>

            <span class="k">return</span> <span class="nx">currentModule</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="nx">currentModule</span><span class="p">.</span><span class="nx">assert_Number_Of_Invisible_Rows</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">numberOfRows</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">getInvisibleRows</span><span class="p">()).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="nx">numberOfRows</span><span class="p">);</span>

            <span class="k">return</span> <span class="nx">currentModule</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="nx">currentModule</span><span class="p">.</span><span class="nx">assert_Visible_Rows_Name_Is_Complete_SearchValue</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">nameToSearch</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">rows</span> <span class="o">=</span> <span class="nx">getVisibleRows</span><span class="p">();</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">rows</span><span class="p">,</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isLoadingRow</span><span class="p">(</span><span class="nx">row</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">expect</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">row</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'td'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">nameToSearch</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">});</span>

            <span class="k">return</span> <span class="nx">currentModule</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="nx">currentModule</span><span class="p">.</span><span class="nx">assert_Visible_Rows_Name_Contains_SearchValue</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">nameToSearch</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">rows</span> <span class="o">=</span> <span class="nx">getVisibleRows</span><span class="p">();</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">rows</span><span class="p">,</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isLoadingRow</span><span class="p">(</span><span class="nx">row</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">expect</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">row</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'td'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="nx">expect</span><span class="p">.</span><span class="nx">stringContaining</span><span class="p">(</span><span class="nx">nameToSearch</span><span class="p">));</span>
                    <span class="p">}</span>
                <span class="p">});</span>

            <span class="k">return</span> <span class="nx">currentModule</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="nx">currentModule</span><span class="p">.</span><span class="nx">assert_Invisible_Rows_Name_Do_Not_Contain_SearchValue</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">nameToSearch</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">rows</span> <span class="o">=</span> <span class="nx">getInvisibleRows</span><span class="p">();</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">rows</span><span class="p">,</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isLoadingRow</span><span class="p">(</span><span class="nx">row</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">expect</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">row</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'td'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="nx">expect</span><span class="p">.</span><span class="nx">not</span><span class="p">.</span><span class="nx">stringContaining</span><span class="p">(</span><span class="nx">nameToSearch</span><span class="p">));</span>
                    <span class="p">}</span>
                <span class="p">});</span>

            <span class="k">return</span> <span class="nx">currentModule</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="kd">function</span> <span class="nx">isLoadingRow</span><span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">row</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">'loading-row'</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">getVisibleRows</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">grep</span><span class="p">(</span><span class="nx">getAllRows</span><span class="p">(),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="nx">$</span><span class="p">(</span><span class="nx">row</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">'display-none'</span><span class="p">);</span> <span class="p">});</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">getInvisibleRows</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">grep</span><span class="p">(</span><span class="nx">getAllRows</span><span class="p">(),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">row</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">'display-none'</span><span class="p">);</span> <span class="p">});</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">getAllRows</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#customer-table-body'</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'tr'</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nb">global</span><span class="p">.</span><span class="nx">SearchCustomerNameScenarioBuilderModule</span> <span class="o">=</span> <span class="nx">currentModule</span><span class="p">;</span>

    <span class="p">})(</span><span class="nx">jest</span><span class="p">,</span> <span class="nx">expect</span><span class="p">);</span>
<span class="p">});</span>

</code></pre></div></div>

<h3 id="resources">Resources</h3>
<ul>
  <li><a href="https://docs.microsoft.com/en-us/visualstudio/javascript/unit-testing-javascript-with-visual-studio?view=vs-2019#unit-tests-in-other-project-types">Microsoft Docs page on Unit testing JavaScript and TypeScript in Visual Studio</a></li>
  <li><a href="https://jestjs.io/docs/en/expect">Jest expect method documentation</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Builder%20pattern">Wikipedia page for the builder pattern</a></li>
</ul>

        </div>
    </article>
    
    <article>
        <header class="article-header">
            <a href="/2019/12/30/Creating-more-maintainable-javascript-with-self-executing-functions.html">Creating more maintainable JavaScript with self-executing functions</a>
        </header>
        
        <span>Dec 30, 2019</span> <br />
        Tags: 
        JavaScript
        
        <div class="article-content">
            <p>I still mostly use regular JavaScript with jQuery in my applications. Before I started writing self-executing modules, my JavaScript was embedded all over the place in HTML and it was untestable (except for running a page in the browser).</p>

<p>A year or so ago a colleague introduced me to the concept of self-executing JavaScript functions. (Thank you Gijs Stoeldraaijers!) After adopting this practice, I found that I could write JavaScript modules with keeping the SOLID principles in mind. The most important benefits are creating smaller modules with a single purpose that can be tested and dependency injection support to make unit testing even easier. Even without adopting unit testing right away the improvements to maintainability were immense for me.</p>

<p>I’ll not go into JavaScript unit testing in this post and do an in-depth post as my next blog post. If you want to look into it, without waiting for that, please look at the <a href="https://docs.microsoft.com/en-us/visualstudio/javascript/unit-testing-javascript-with-visual-studio?view=vs-2019#unit-tests-in-other-project-types">Microsoft Docs page on Unit testing JavaScript and TypeScript in Visual Studio</a>.</p>

<p><strong>Table of contents:</strong></p>
<ul id="markdown-toc">
  <li><a href="#example-of-the-old-way-of-working-embedding-javascript-in-the-page" id="markdown-toc-example-of-the-old-way-of-working-embedding-javascript-in-the-page">Example of the old way of working (embedding JavaScript in the page)</a></li>
  <li><a href="#self-executing-functions" id="markdown-toc-self-executing-functions">Self-executing functions</a></li>
  <li><a href="#separating-html-control-events-and-javascript-hook-ups" id="markdown-toc-separating-html-control-events-and-javascript-hook-ups">Separating HTML control events and JavaScript hook-ups</a></li>
  <li><a href="#separating-html-templating-from-your-javascript-code" id="markdown-toc-separating-html-templating-from-your-javascript-code">Separating HTML templating from your JavaScript code</a></li>
</ul>

<h3 id="example-of-the-old-way-of-working-embedding-javascript-in-the-page">Example of the old way of working (embedding JavaScript in the page)</h3>
<p>Below, I have created an example of my old way of writing JavaScript on an overview page that loads data from an API endpoint and has some filter capabilities.</p>

<p>The data templates are hardcoded strings in the JavaScript and the search button event hookup is done through HTML markup.</p>

<p>A working Visual Studio project with the code listed below can be found in my <a href="https://github.com/SamanthaNeilen/JavascriptModulesExamples/tree/V1.0-Embedded-JavaScript">JavaScriptModuleExamples repository on GitHub with the tag “V1.0-Embedded-JavaScript”</a>.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Customer overview<span class="nt">&lt;/h1&gt;</span>

    @* Searchform *@
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"search-customer"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"searchCustomerName"</span> <span class="na">class=</span><span class="s">"col-sm-2 col-form-label"</span><span class="nt">&gt;</span>@Texts.Name<span class="nt">&lt;/label&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-5"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"searchCustomerName"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"searchEmail"</span> <span class="na">class=</span><span class="s">"col-sm-2 col-form-label"</span><span class="nt">&gt;</span>@Texts.Email<span class="nt">&lt;/label&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-5"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"searchEmail"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"searchCountry"</span> <span class="na">class=</span><span class="s">"col-sm-2 col-form-label"</span><span class="nt">&gt;</span>@Texts.Country<span class="nt">&lt;/label&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-5"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"searchCountry"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-primary col-sm-2"</span> <span class="na">onclick=</span><span class="s">"filterData()"</span><span class="nt">&gt;</span>@Texts.Search<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    @* Grid for data *@
    <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table mt-2"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;thead&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>@Texts.Name<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>@Texts.Email<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>@Texts.Country<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/thead&gt;</span>
        <span class="nt">&lt;tbody</span> <span class="na">id=</span><span class="s">"customer-table-body"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"loading-row"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"3"</span><span class="nt">&gt;&lt;progress&gt;&lt;/progress&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/tbody&gt;</span>
    <span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/div&gt;</span>

@section Scripts {
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
        <span class="kd">const</span> <span class="nx">CUSTOMER_ROW_SELECTOR</span> <span class="o">=</span> <span class="s1">'.customer-row'</span><span class="p">,</span>
            <span class="nx">LOADING_ROW_SELECTOR</span> <span class="o">=</span> <span class="s1">'.loading-row'</span><span class="p">,</span>
            <span class="nx">DISPLAY_NONE_CLASS</span> <span class="o">=</span> <span class="s1">'display-none'</span><span class="p">,</span>
            <span class="nx">CUSTOMER_TABLE_BODY</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#customer-table-body'</span><span class="p">);</span>

        <span class="kd">function</span> <span class="nx">loadData</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">showLoader</span><span class="p">();</span>

            <span class="nx">$</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'https://localhost:44313/api/customer'</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">customerList</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">jqXHR</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">CUSTOMER_TABLE_BODY</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">getDataRows</span><span class="p">(</span><span class="nx">customerList</span><span class="p">));</span>
                    <span class="nx">showCustomerRows</span><span class="p">(</span><span class="nx">CUSTOMER_TABLE_BODY</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">CUSTOMER_ROW_SELECTOR</span><span class="p">));</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">jqXHR</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">errorThrown</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">alert</span><span class="p">(</span><span class="s1">'error '</span> <span class="o">+</span> <span class="nx">textStatus</span> <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> <span class="nx">errorThrown</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">getDataRows</span><span class="p">(</span><span class="nx">customerList</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">rowTemplate</span> <span class="o">=</span> <span class="s1">'&lt;tr class="customer-row"&gt;&lt;td&gt;{name}&lt;/td&gt;&lt;td&gt;{email}&lt;/td&gt;&lt;td&gt;{country}&lt;/td&gt;&lt;/tr&gt;'</span><span class="p">;</span>
            <span class="kd">let</span> <span class="nx">dataRows</span> <span class="o">=</span> <span class="s1">'&lt;tr class="loading-row"&gt;&lt;td colspan="3"&gt;&lt;progress&gt;&lt;/progress&gt;&lt;/td&gt;&lt;/tr&gt;'</span><span class="p">;</span>

            <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">customerList</span><span class="p">,</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">customer</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">dataRows</span> <span class="o">+=</span> <span class="nx">rowTemplate</span>
                        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'{name}'</span><span class="p">,</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'{email}'</span><span class="p">,</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">email</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'{country}'</span><span class="p">,</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">country</span><span class="p">);</span>
                <span class="p">});</span>

            <span class="k">return</span> <span class="nx">dataRows</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">showLoader</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">CUSTOMER_TABLE_BODY</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">LOADING_ROW_SELECTOR</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">DISPLAY_NONE_CLASS</span><span class="p">);</span>

            <span class="kd">const</span> <span class="nx">dataRows</span> <span class="o">=</span> <span class="nx">CUSTOMER_TABLE_BODY</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">CUSTOMER_ROW_SELECTOR</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">dataRows</span><span class="p">,</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">row</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">DISPLAY_NONE_CLASS</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">showCustomerRows</span><span class="p">(</span><span class="nx">customerRows</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">customerRows</span><span class="p">,</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">row</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">DISPLAY_NONE_CLASS</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="nx">CUSTOMER_TABLE_BODY</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">LOADING_ROW_SELECTOR</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">DISPLAY_NONE_CLASS</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">filterData</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">showLoader</span><span class="p">();</span>

            <span class="kd">const</span> <span class="nx">customerRows</span> <span class="o">=</span> <span class="nx">CUSTOMER_TABLE_BODY</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">CUSTOMER_ROW_SELECTOR</span><span class="p">);</span>
            <span class="kd">const</span> <span class="nx">searchName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#searchCustomerName'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
            <span class="kd">const</span> <span class="nx">searchEmail</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#searchEmail'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
            <span class="kd">const</span> <span class="nx">searchCountry</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#searchCountry'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>

            <span class="kd">const</span> <span class="nx">rowsToShow</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">grep</span><span class="p">(</span><span class="nx">customerRows</span><span class="p">,</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">customerRow</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">let</span> <span class="nx">columns</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">customerRow</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'td'</span><span class="p">);</span>

                    <span class="k">return</span> <span class="nx">isMatchForFilter</span><span class="p">(</span><span class="nx">searchName</span><span class="p">,</span> <span class="nx">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                        <span class="nx">isMatchForFilter</span><span class="p">(</span><span class="nx">searchEmail</span><span class="p">,</span> <span class="nx">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                        <span class="nx">isMatchForFilter</span><span class="p">(</span><span class="nx">searchCountry</span><span class="p">,</span> <span class="nx">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">);</span>


                <span class="p">});</span>

           <span class="nx">showCustomerRows</span><span class="p">(</span><span class="nx">rowsToShow</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">isMatchForFilter</span><span class="p">(</span><span class="nx">searchValue</span><span class="p">,</span> <span class="nx">valueInRow</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">searchValue</span> <span class="o">===</span> <span class="s1">''</span> <span class="o">||</span>
                <span class="nx">valueInRow</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">searchValue</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">loadData</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="nt">&lt;/script&gt;</span>
}
</code></pre></div></div>

<h2 id="self-executing-functions">Self-executing functions</h2>

<p>An example of a self-executing module is shown below. The proper term for the self-executing module is Immediately Invoked Function Expressions or IIFE.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">someOtherInjectedModule</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">CURRENT_MODULE</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">const</span> <span class="nx">PRIVATE_VARIABLE</span> <span class="o">=</span> <span class="s1">'Hello world!'</span><span class="p">;</span>

    <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">myPublicFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">privateFunction</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">privateFunction</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">PRIVATE_VARIABLE</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nb">window</span><span class="p">.</span><span class="nx">ModuleExample</span> <span class="o">=</span> <span class="nx">CURRENT_MODULE</span><span class="p">;</span>

<span class="p">})(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">SomeOtherModule</span><span class="p">);</span>

<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">ModuleExample</span><span class="p">.</span><span class="nx">myPublicFunction</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>The function parameters make it possible to inject dependencies. This has 2 benefits.</p>

<ol>
  <li>
    <p>You can inject mocks when unit testing. This makes unit testing much easier.</p>
  </li>
  <li>
    <p>All the external dependencies, that the class relies on, are shown at the top and bottom of the file.</p>
  </li>
</ol>

<p>Another great benefit that this pattern gives is variable scoping. All variables scoped within the module are scoped to the function and do not have to be global.</p>

<p>The CURRENT_MODULE object and all its functions/properties are exposed globally by assigning it to a global window property. All the other “private” functions and variables are never exposed outside the scope of the self-executing function.</p>

<p>The  example as shown in the first code listing of this post rewritten with an IIFE is shown below.</p>

<p>A working Visual Studio project with the code listed below can be found in my <a href="https://github.com/SamanthaNeilen/JavascriptModulesExamples">JavaScriptModuleExamples repository on GitHub</a>.</p>

<p>customer-overview.js:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">customerService</span><span class="p">,</span> <span class="nx">utilitiesModule</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">CURRENT_MODULE</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">CUSTOMER_ROW_SELECTOR</span> <span class="o">=</span> <span class="s1">'.customer-row'</span><span class="p">,</span>
        <span class="nx">LOADING_ROW_SELECTOR</span> <span class="o">=</span> <span class="s1">'.loading-row'</span><span class="p">,</span>
        <span class="nx">CUSTOMER_TABLE_BODY</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#customer-table-body'</span><span class="p">);</span>

    <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">initialize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#customerOverviewSearchButton'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">filterData</span><span class="p">);</span>
        <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">loadData</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">loadData</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">showLoader</span><span class="p">();</span>

        <span class="nx">customerService</span><span class="p">.</span><span class="nx">getCustomers</span><span class="p">(</span><span class="nx">showCustomerData</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">filterData</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">showLoader</span><span class="p">();</span>

        <span class="kd">const</span> <span class="nx">customerRows</span> <span class="o">=</span> <span class="nx">CUSTOMER_TABLE_BODY</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">CUSTOMER_ROW_SELECTOR</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">searchName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#searchCustomerName'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">searchEmail</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#searchEmail'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">searchCountry</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#searchCountry'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>

        <span class="kd">const</span> <span class="nx">rowsToShow</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">grep</span><span class="p">(</span><span class="nx">customerRows</span><span class="p">,</span>
            <span class="kd">function</span> <span class="p">(</span><span class="nx">customerRow</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">const</span> <span class="nx">columns</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">customerRow</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'td'</span><span class="p">);</span>

                <span class="k">return</span> <span class="nx">utilitiesModule</span><span class="p">.</span><span class="nx">isMatchForFilter</span><span class="p">(</span><span class="nx">searchName</span><span class="p">,</span> <span class="nx">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                    <span class="nx">utilitiesModule</span><span class="p">.</span><span class="nx">isMatchForFilter</span><span class="p">(</span><span class="nx">searchEmail</span><span class="p">,</span> <span class="nx">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                    <span class="nx">utilitiesModule</span><span class="p">.</span><span class="nx">isMatchForFilter</span><span class="p">(</span><span class="nx">searchCountry</span><span class="p">,</span> <span class="nx">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">);</span>
            <span class="p">});</span>

        <span class="nx">showCustomerRows</span><span class="p">(</span><span class="nx">rowsToShow</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">showCustomerData</span><span class="p">(</span><span class="nx">customerList</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">CUSTOMER_TABLE_BODY</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">getDataRows</span><span class="p">(</span><span class="nx">customerList</span><span class="p">));</span>
        <span class="nx">showCustomerRows</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">getDataRows</span><span class="p">(</span><span class="nx">customerList</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">outerHtmlProperty</span> <span class="o">=</span> <span class="s1">'outerHTML'</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">dataRowTemplateId</span> <span class="o">=</span> <span class="s1">'data-row-template'</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">rowTemplate</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#'</span> <span class="o">+</span> <span class="nx">dataRowTemplateId</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="nx">outerHtmlProperty</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'id="'</span> <span class="o">+</span> <span class="nx">dataRowTemplateId</span> <span class="o">+</span> <span class="s1">'"'</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>

        <span class="kd">let</span> <span class="nx">dataRows</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">LOADING_ROW_SELECTOR</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="nx">outerHtmlProperty</span><span class="p">);</span>

        <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">customerList</span><span class="p">,</span>
            <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">customer</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">dataRows</span> <span class="o">+=</span> <span class="nx">rowTemplate</span>
                    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'{name}'</span><span class="p">,</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'{email}'</span><span class="p">,</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">email</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'{country}'</span><span class="p">,</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">country</span><span class="p">);</span>
            <span class="p">});</span>

        <span class="k">return</span> <span class="nx">dataRows</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">showLoader</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">utilitiesModule</span><span class="p">.</span><span class="nx">showElement</span><span class="p">(</span><span class="nx">LOADING_ROW_SELECTOR</span><span class="p">,</span> <span class="nx">CUSTOMER_TABLE_BODY</span><span class="p">);</span>

        <span class="nx">forEachCustomerRow</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">utilitiesModule</span><span class="p">.</span><span class="nx">hideElement</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">CUSTOMER_TABLE_BODY</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">showCustomerRows</span><span class="p">(</span><span class="nx">filteredRows</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">forEachCustomerRow</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">utilitiesModule</span><span class="p">.</span><span class="nx">showElement</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">CUSTOMER_TABLE_BODY</span><span class="p">);</span>
        <span class="p">},</span> <span class="nx">filteredRows</span><span class="p">);</span>

        <span class="nx">utilitiesModule</span><span class="p">.</span><span class="nx">hideElement</span><span class="p">(</span><span class="nx">LOADING_ROW_SELECTOR</span><span class="p">,</span> <span class="nx">CUSTOMER_TABLE_BODY</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">forEachCustomerRow</span><span class="p">(</span><span class="nx">callBack</span><span class="p">,</span> <span class="nx">filteredRows</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">customerRows</span> <span class="o">=</span> <span class="nx">CUSTOMER_TABLE_BODY</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">CUSTOMER_ROW_SELECTOR</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">filteredRows</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">customerRows</span> <span class="o">=</span> <span class="nx">filteredRows</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">customerRows</span><span class="p">,</span>
            <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">callBack</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">row</span><span class="p">));</span>
            <span class="p">});</span>
    <span class="p">}</span>

    <span class="nb">window</span><span class="p">.</span><span class="nx">customerOverviewModule</span> <span class="o">=</span> <span class="nx">CURRENT_MODULE</span><span class="p">;</span>

<span class="p">})(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">customerService</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">utilitiesModule</span><span class="p">);</span>

<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">customerOverviewModule</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>
<p>utilities.js</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">CURRENT_MODULE</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">DISPLAY_NONE_CLASS</span> <span class="o">=</span> <span class="s1">'display-none'</span><span class="p">;</span>

    <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">isMatchForFilter</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">searchValue</span><span class="p">,</span> <span class="nx">valueInRow</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">searchValue</span> <span class="o">===</span> <span class="s1">''</span> <span class="o">||</span>
            <span class="nx">valueInRow</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">searchValue</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">hideElement</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elementSelector</span><span class="p">,</span> <span class="nx">parentSelector</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nx">getParent</span><span class="p">(</span><span class="nx">parentSelector</span><span class="p">);</span>
        <span class="nx">parent</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">elementSelector</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">DISPLAY_NONE_CLASS</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">showElement</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elementSelector</span><span class="p">,</span> <span class="nx">parentSelector</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nx">getParent</span><span class="p">(</span><span class="nx">parentSelector</span><span class="p">);</span>
        <span class="nx">parent</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">elementSelector</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">DISPLAY_NONE_CLASS</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">getParent</span><span class="p">(</span><span class="nx">parentSelector</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">parentSelector</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">parent</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">parentSelector</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">parent</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nb">window</span><span class="p">.</span><span class="nx">utilitiesModule</span> <span class="o">=</span> <span class="nx">CURRENT_MODULE</span><span class="p">;</span>
<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>
</code></pre></div></div>
<p>customer-service.js</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">CURRENT_MODULE</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">CUSTOMER_URI</span> <span class="o">=</span> <span class="s1">'https://localhost:44313/api/customer'</span><span class="p">;</span>

    <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">getCustomers</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">successCallBack</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">CUSTOMER_URI</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">customerList</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">jqXHR</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">successCallBack</span><span class="p">(</span><span class="nx">customerList</span><span class="p">);</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">jqXHR</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">errorThrown</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s1">'error '</span> <span class="o">+</span> <span class="nx">textStatus</span> <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> <span class="nx">errorThrown</span><span class="p">);</span>
            <span class="p">});</span>
    <span class="p">};</span>
  
    <span class="nb">window</span><span class="p">.</span><span class="nx">customerService</span> <span class="o">=</span> <span class="nx">CURRENT_MODULE</span><span class="p">;</span>
<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>
</code></pre></div></div>

<p>index.cshtml:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Customer overview<span class="nt">&lt;/h1&gt;</span>

    @* Searchform *@
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"search-customer"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"searchCustomerName"</span> <span class="na">class=</span><span class="s">"col-sm-2 col-form-label"</span><span class="nt">&gt;</span>@Texts.Name<span class="nt">&lt;/label&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-5"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"searchCustomerName"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"searchEmail"</span> <span class="na">class=</span><span class="s">"col-sm-2 col-form-label"</span><span class="nt">&gt;</span>@Texts.Email<span class="nt">&lt;/label&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-5"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"searchEmail"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"searchCountry"</span> <span class="na">class=</span><span class="s">"col-sm-2 col-form-label"</span><span class="nt">&gt;</span>@Texts.Country<span class="nt">&lt;/label&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-5"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"searchCountry"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"customerOverviewSearchButton"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-primary col-sm-2"</span><span class="nt">&gt;</span>@Texts.Search<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    @* Grid for data *@
    <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table mt-2"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;thead&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>@Texts.Name<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>@Texts.Email<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>@Texts.Country<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/thead&gt;</span>
        <span class="nt">&lt;tbody</span> <span class="na">id=</span><span class="s">"customer-table-body"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"loading-row"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"3"</span><span class="nt">&gt;&lt;progress&gt;&lt;/progress&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/tbody&gt;</span>
    <span class="nt">&lt;/table&gt;</span>

    @* Row templates *@
    <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"display-none"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tr</span> <span class="na">id=</span><span class="s">"data-row-template"</span> <span class="na">class=</span><span class="s">"customer-row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;td&gt;</span>{name}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>{email}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>{country}<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/div&gt;</span>

@section Scripts {
    <span class="nt">&lt;environment</span> <span class="na">include=</span><span class="s">"Development"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"~/js/utilities.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"~/js/customer-service.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"~/js/customer-overview.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/environment&gt;</span>
    <span class="nt">&lt;environment</span> <span class="na">exclude=</span><span class="s">"Development"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"~/js/dist/customer-overview.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/environment&gt;</span>
}
</code></pre></div></div>
<p>bundleconfig.json (to generate the minified file in de dist folder)</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"outputFileName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"wwwroot/css/site.min.css"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inputFiles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"wwwroot/css/site.css"</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"outputFileName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"wwwroot/js/dist/customer-overview.min.js"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inputFiles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"wwwroot/js/utilities.js"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"wwwroot/js/customer-service.js"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"wwwroot/js/customer-overview.js"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"minify"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="s2">"renameLocals"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"sourceMap"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>
<h2 id="separating-html-control-events-and-javascript-hook-ups">Separating HTML control events and JavaScript hook-ups</h2>

<p>When embedding JavaScript in the HTML pages, the event hookups are usually written directly in the controls, mixing markup with the JavaScript. In my opinion, this makes it harder to find how and where my JavaScript functions are used.</p>

<p>By hooking up al the events in the JavaScript module there’s no need to embed any JavaScript in the markup for the page. The HTML markup is only used for layout. The functionality and/or interaction logic is completely separate and centralized in the JavaScript modules.</p>

<p>There are still dependencies between the DOM and the JavaScript module but the test framework I have been using (Jest) provides a DOM mock. The DOM mock can be accessed like the browser DOM and you can test the interactions and their results. I’ll show examples in my next blog post.</p>

<p>The example page with embedded JavaScript, rewritten with an IIFE is shown below.</p>

<p>Event hookup before (in the html):</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-primary col-sm-2"</span> <span class="na">onclick=</span><span class="s">"window.customerOverviewModule.filterData()"</span><span class="nt">&gt;</span>@Texts.Search<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div>

<p>Event hookup after refactoring to the IIFE:</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"customerOverviewSearchButton"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-primary col-sm-2"</span><span class="nt">&gt;</span>@Texts.Search<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">customerService</span><span class="p">,</span> <span class="nx">utilitiesModule</span><span class="p">)</span> <span class="p">{</span>

     <span class="c1">///...</span>
    
     <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">initialize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#customerOverviewSearchButton'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">filterData</span><span class="p">);</span>
        
        <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">loadData</span><span class="p">();</span>
    <span class="p">};</span>

     <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">loadData</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
         <span class="c1">///...</span>
     <span class="p">};</span>
    
     <span class="nx">CURRENT_MODULE</span><span class="p">.</span><span class="nx">filterData</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
     	<span class="c1">///...</span>
     <span class="p">};</span>
     
     <span class="c1">///...</span>
     
     <span class="nb">window</span><span class="p">.</span><span class="nx">customerOverviewModule</span> <span class="o">=</span> <span class="nx">CURRENT_MODULE</span><span class="p">;</span>

<span class="p">})(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">customerService</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">utilitiesModule</span><span class="p">);</span>

<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">customerOverviewModule</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>
<h2 id="separating-html-templating-from-your-javascript-code">Separating HTML templating from your JavaScript code</h2>

<p>Sometimes you have to create multiple repeating element groups from a JavaScript array. An example is calling an API to retrieve orders then printing a line with each order object. You might define a constant with the HTML template as a string in your JavaScript. For maintainability, code completion and analysis benefits, I find it better to just include a hidden div with the template on the page. You won’t have to deal with escaping reserved characters in a string like quotes and slashes and also gain indenting and linting support from your IDE.</p>

<p>The HTML string used before the refactoring was:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">getDataRows</span><span class="p">(</span><span class="nx">customerList</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">rowTemplate</span> <span class="o">=</span> <span class="s1">'&lt;tr class="customer-row"&gt;&lt;td&gt;{name}&lt;/td&gt;&lt;td&gt;{email}&lt;/td&gt;&lt;td&gt;{country}&lt;/td&gt;&lt;/tr&gt;'</span><span class="p">;</span>
            <span class="kd">let</span> <span class="nx">dataRows</span> <span class="o">=</span> <span class="s1">'&lt;tr class="loading-row"&gt;&lt;td colspan="3"&gt;&lt;progress&gt;&lt;/progress&gt;&lt;/td&gt;&lt;/tr&gt;'</span><span class="p">;</span>

            <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">customerList</span><span class="p">,</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">customer</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">dataRows</span> <span class="o">+=</span> <span class="nx">rowTemplate</span>
                        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'{name}'</span><span class="p">,</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'{email}'</span><span class="p">,</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">email</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'{country}'</span><span class="p">,</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">country</span><span class="p">);</span>
                <span class="p">});</span>

            <span class="k">return</span> <span class="nx">dataRows</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>
<p>The code using templating from the overview page example as an IIFE  is shown below:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code> @* Grid for data *@
    <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table mt-2"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;thead&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>@Texts.Name<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>@Texts.Email<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>@Texts.Country<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/thead&gt;</span>
        <span class="nt">&lt;tbody</span> <span class="na">id=</span><span class="s">"customer-table-body"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"loading-row"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"3"</span><span class="nt">&gt;&lt;progress&gt;&lt;/progress&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/tbody&gt;</span>
    <span class="nt">&lt;/table&gt;</span>

    @* Row templates *@
    <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"display-none"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tr</span> <span class="na">id=</span><span class="s">"data-row-template"</span> <span class="na">class=</span><span class="s">"customer-row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;td&gt;</span>{name}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>{email}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>{country}<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/table&gt;</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">function</span> <span class="nx">getDataRows</span><span class="p">(</span><span class="nx">customerList</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">outerHtmlProperty</span> <span class="o">=</span> <span class="s1">'outerHTML'</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">dataRowTemplateId</span> <span class="o">=</span> <span class="s1">'data-row-template'</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">rowTemplate</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#'</span> <span class="o">+</span> <span class="nx">dataRowTemplateId</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="nx">outerHtmlProperty</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'id="'</span> <span class="o">+</span> <span class="nx">dataRowTemplateId</span> <span class="o">+</span> <span class="s1">'"'</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>

        <span class="kd">let</span> <span class="nx">dataRows</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">LOADING_ROW_SELECTOR</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="nx">outerHtmlProperty</span><span class="p">);</span>

        <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">customerList</span><span class="p">,</span>
            <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">customer</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">dataRows</span> <span class="o">+=</span> <span class="nx">rowTemplate</span>
                    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'{name}'</span><span class="p">,</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'{email}'</span><span class="p">,</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">email</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'{country}'</span><span class="p">,</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">country</span><span class="p">);</span>
            <span class="p">});</span>

        <span class="k">return</span> <span class="nx">dataRows</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div>

        </div>
    </article>
    
    <article>
        <header class="article-header">
            <a href="/2019/10/19/Managing-your-client-side-libraries.html">Managing your client-side libraries</a>
        </header>
        
        <span>Oct 19, 2019</span> <br />
        Tags: 
        JavaScript
        
        Stylesheets
        
        <div class="article-content">
            <p>If you start a new .NET Core Razor Pages or MVC project in Visual Studio, it will create a project containing a working starter website. However, due to the speed at which 3rd party libraries update, the included version of Bootstrap and jQuery will probably be out of date. There will also be an empty site stylesheet and JavaScript file with their nested minified equivalents. These placeholder files will not update their minified counterparts if you don’t configure a minifyer.  In this blog post, I explain the tags used for referencing client-side libraries, how to use LibMan for 3rd party client-side libraries and how to use BuildBundlerMinifier to bundle and minify files in your project.</p>

<p><strong>Table of contents:</strong></p>
<ul id="markdown-toc">
  <li><a href="#how-the-script-and-stylesheets-are-referenced-in-the-view-files" id="markdown-toc-how-the-script-and-stylesheets-are-referenced-in-the-view-files">How the script and stylesheets are referenced in the view files.</a></li>
  <li><a href="#managing-3rd-party-client-side-libraries-with-libman" id="markdown-toc-managing-3rd-party-client-side-libraries-with-libman">Managing 3rd party Client-Side libraries with LibMan</a></li>
  <li><a href="#how-to-bundle-and-minify-your-custom-scripts" id="markdown-toc-how-to-bundle-and-minify-your-custom-scripts">How to bundle and minify your custom scripts</a></li>
</ul>
<h3 id="how-the-script-and-stylesheets-are-referenced-in-the-view-files">How the script and stylesheets are referenced in the view files.</h3>

<p>.NET Core projects use the syntax below in the _Layout.cshtml to include 3rd party client-side libraries.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span> 
    <span class="nt">&lt;environment</span> <span class="na">include=</span><span class="s">"Development"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"~/lib/bootstrap/dist/css/bootstrap.css"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/environment&gt;</span>
    <span class="nt">&lt;environment</span> <span class="na">exclude=</span><span class="s">"Development"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"</span>
              <span class="na">asp-fallback-href=</span><span class="s">"~/lib/bootstrap/dist/css/bootstrap.min.css"</span>
              <span class="na">asp-fallback-test-class=</span><span class="s">"sr-only"</span> <span class="na">asp-fallback-test-property=</span><span class="s">"position"</span> <span class="na">asp-fallback-test-value=</span><span class="s">"absolute"</span>
              <span class="na">crossorigin=</span><span class="s">"anonymous"</span>
              <span class="na">integrity=</span><span class="s">"sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/environment&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"~/css/site.css"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;environment</span> <span class="na">include=</span><span class="s">"Development"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"~/lib/jquery/dist/jquery.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"~/lib/bootstrap/dist/js/bootstrap.bundle.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/environment&gt;</span>
    <span class="nt">&lt;environment</span> <span class="na">exclude=</span><span class="s">"Development"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</span>
                <span class="na">asp-fallback-src=</span><span class="s">"~/lib/jquery/dist/jquery.min.js"</span>
                <span class="na">asp-fallback-test=</span><span class="s">"window.jQuery"</span>
                <span class="na">crossorigin=</span><span class="s">"anonymous"</span>
                <span class="na">integrity=</span><span class="s">"sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"</span>
                <span class="na">asp-fallback-src=</span><span class="s">"~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"</span>
                <span class="na">asp-fallback-test=</span><span class="s">"window.jQuery &amp;&amp; window.jQuery.fn &amp;&amp; window.jQuery.fn.modal"</span>
                <span class="na">crossorigin=</span><span class="s">"anonymous"</span>
                <span class="na">integrity=</span><span class="s">"sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/environment&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"~/js/site.js"</span> <span class="na">asp-append-version=</span><span class="s">"true"</span><span class="nt">&gt;&lt;/script&gt;</span>

    @RenderSection("Scripts", required: false)
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Notice the environment elements. When using the development environment, the local unminified files are used. For all other environments, it uses a CDN (content delivery network) link to a minified file. The value of “environment” is an environment variable and can be set via the Debug tab in the property pages or by changing the Properties/launchsettings file. For more information on using the environment variable see <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/environments">the Microsoft docs page on this variable</a>.</p>

<p>The asp-fallback-test attribute will check if a CSS class or JavaScript function for that specific file is available. If the test fails it will load the (local) script file that is defined in the asp-fallback-src attribute. For more information on the benefits of using the CDN and to dive deeper into the fallback attributes see the <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/views/tag-helpers/built-in/link-tag-helper">Microsoft Docs page for the Link Tag Helper</a>.</p>

<p>The crossorigin attribute is always anonymous unless a cookie or user credentials are required to access the file from the remote location. For more information on this attribute see the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes">MDN docs page for the crossorigin attribute</a>.</p>

<p>The integrity attribute is probably the most important to know about in regard to upgrading library versions. The value of this attribute is a cryptographic hash that matches the contents for the file referenced file. If the referenced file and the hash no longer match up, the browser will see the file as a security compromise and block it. For more information on the integrity attribute, see <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity">the MDN docs page for the integrity attribute</a>. This page also has instructions and links for getting the appropriate hash for the files that you are trying to reference and embed on your website.</p>

<h3 id="managing-3rd-party-client-side-libraries-with-libman">Managing 3rd party Client-Side libraries with LibMan</h3>

<p>We used to manage front-end libraries with NuGet or include files manually. These days Visual Studio has support for LibMan for managing client-side libraries from several sources in a .NET Core web project. LibMan already has a basic <a href="https://docs.microsoft.com/en-us/aspnet/core/client-side/libman/libman-vs">“Getting started” guide on Microsoft Docs</a> so I will not be repeating the information contained in this post.</p>

<p>If you need packages from NPM that have multiple dependencies, then LibMan (unpkg/jsDelivr source) will not crawl those dependencies and include any  of them. My advice is to just use NPM in that case. Also, try to stick to a single client-side package manager when possible for your project. This way the team won’t get confused about how the libraries are managed.</p>

<p>LibMan is good at managing libraries without extra dependencies from cdnjs or other CDNs. If you use the “Add -&gt; Client-Side library” option you get a visual editor however the “Manage Client-Side libraries” option will just open the libman.json file. This is something I found confusing at first. It turns out that the code completion in the JSON file provides the same experience as the visual editor. (It does, however, take a few minutes for the IntelliSense to fetch the results from the provider. So, if you’re not seeing the list of libraries or files, just wait a minute.)</p>

<p>A few screenshots comparing the visual editor vs the libman.json experience:</p>

<p><img src="/assets/images/20191019/ComparingLibrarySearch.png" alt="[Comparing library search]" /></p>

<p><img src="/assets/images/20191019/ComparingVersionSearch.png" alt="[Comparing version search]" /></p>

<p><img src="/assets/images/20191019/ComparingFileSelection.png" alt="[Comparing file selection]" /></p>

<p>LibMan has out-of-the-box support for several sources but you can use the filesystem source if you need a file from another source. See the screenshot below for an example. The filesystem fallback only works with a complete URL to a single file in the library input field. (It will not work with wildcards or a directory).</p>

<p><img src="/assets/images/20191019/FilesystemSearch.png" alt="[Visual editor filesystem search]" /></p>

<h3 id="how-to-bundle-and-minify-your-custom-scripts">How to bundle and minify your custom scripts</h3>

<p>When you create a new .NET Core web project in Visual Studio, an empty site.css and site.js with their minified counterparts will be added. When editing the unminified files, the minified files will not be updated with the changes made. You will need to configure an additional minification tool to enable the minification.</p>

<p>I use the <a href="https://github.com/madskristensen/BundlerMinifier">BuildBundlerMinifier</a> NuGet package to bundle and minify my own custom script and stylesheet files. To use it, first install the BuildBindlerMinifier package and add a  bundleconfig.json to the project containing the JSON contents as shown below to enable minification of the default files. Note that the input files parameter is an array, so you could provide multiple input files to bundle into one output file.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"outputFileName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"wwwroot/css/site.min.css"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inputFiles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"wwwroot/css/site.css"</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"outputFileName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"wwwroot/js/site.min.js"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inputFiles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"wwwroot/js/site.js"</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="s2">"minify"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="s2">"renameLocals"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"sourceMap"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>If you build the project, the minified files will be updated with the contents from the input files.</p>

<p>For information on how to configure bundling and minification for .NET Core, see <a href="https://docs.microsoft.com/en-us/aspnet/core/client-side/bundling-and-minification">the Microsoft docs pages on bundling and minification</a>.</p>


        </div>
    </article>
    
    <center><p><a href="/archive">For additional posts see the archive page for an overview of all available posts</a></p></center>
    
</div>

                </main>
            </div>
            <div class="col-md-3">
                <aside aria-label="sidebar">
                    <section class="sidebar-section">
    <h3>About me</h3>
    I am a dutch .NET developer.
    I have been coding professionally since 2008.
    On this blog, I will be writing about multiple subjects that I use in my daily programming job or subjects that I am studying.
</section>
<section class="sidebar-section">
    <h3>Social</h3>
    <a href="https://github.com/SamanthaNeilen"><i class="fa fa-github" aria-hidden="true"></i><span>&nbsp;SamanthaNeilen</span></a> <br />
    <a href="https://twitter.com/NeilenSamantha"><i class="fa fa-twitter" aria-hidden="true"></i><span>&nbsp;NeilenSamantha</span></a> <br />
    <a href="https://www.linkedin.com/in/samantha-neilen-16153713"><i class="fa fa-linkedin" aria-hidden="true"></i><span>&nbsp;Samantha Neilen</span></a><br />
    Subscribe via <a href="/feed.xml">RSS</a>
</section>
<section class="sidebar-section">
    <h3>Last posts </h3>
    
    <a href="/2020/05/04/Calling-async-methods-with-configureawait.html">Calling async methods with ConfigureAwait</a> <br />
    <div class="last-posts-spacer"></div>
    
    <a href="/2020/03/18/Tips-for-building-habits-around-working-from-home.html">Tips for building habits around working from home</a> <br />
    <div class="last-posts-spacer"></div>
    
    <a href="/2020/02/08/Unit-testing-self-executing-JavaScript-Modules-in-Visual-Studio.html">Unit testing self-executing JavaScript modules in Visual Studio</a> <br />
    <div class="last-posts-spacer"></div>
    
    <a href="/2019/12/30/Creating-more-maintainable-javascript-with-self-executing-functions.html">Creating more maintainable JavaScript with self-executing functions</a> <br />
    <div class="last-posts-spacer"></div>
    
    <a href="/2019/10/19/Managing-your-client-side-libraries.html">Managing your client-side libraries</a> <br />
    <div class="last-posts-spacer"></div>
    
    <a href="/archive">Archive</a>
</section>
                </aside>
            </div>
        </div>
    </div>
</body>
</html>
