<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Samantha Neilen</title>
    <meta name="description" content="My name is Samantha Neilen, a dutch .Net developer. I have been coding professionaly since 2008. On this blog I will be writing about multiple subjects that ...">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/assets/css/site.css" />
    <link rel="canonical" href="https://samanthaneilen.github.io/">
    <link rel="alternate" type="application/rss+xml" title="Samantha Neilen" href="/feed.xml">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
    <header aria-label="header" class="header">
        <span class="header-text">Samantha Neilen</span>
    </header>
</div>
        <div class="row">
            <div class="col-md-7 col-md-offset-1">
                <main class="page-content" aria-label="content">
                    <div>
    
    
    
    <article>
        <header class="article-header">
            <a href="/2019/08/10/Front-end-design.html">Front-end design</a>
        </header>
        
        <span>Aug 10, 2019</span> <br />
        Tags: 
        UX
        
        UserInterface
        
        <div class="article-content">
            <h3 id="bootstrap"><a href="https://getbootstrap.com/">Bootstrap</a></h3>

<p>When creating a new website with .NET Core, the template will already contain the Bootstrap design framework. This framework uses a grid system for creating a layout, has some out-of-the-box styled controls like dropdowns and tabs and has an icon set to use. Next to the default color scheme it has some guidance on how to create your own color schemes. Bootstrap also has an eco-system of templates based on Bootstrap to get inspiration for your own designs.</p>

<h3 id="office-fabric-core"><a href="https://developer.microsoft.com/en-us/fabric#/get-started">Office Fabric (Core)</a></h3>

<p>Another framework like Bootstrap is Office Fabric. This is a front-end design framework from Microsoft that can be used to design a website to look like an Office 365 application. This can be especially useful if you are creating a SharePoint hosted app or if you are creating  an app in an enterprise environment where users use a lot of the Office 365 websites. Users will get a certain feeling of consistency between all the applications and recognize iconography. The Core framework is a stylesheet that comes with a grid system, fonts, animation classes and an icon set that is used in Office 365 and contain icons for most Office applications. The website for Office Fabric also lists the colors for the Microsoft application. There are also out-of-the-box web controls, but these use the React framework. The controls that use just vanilla JavaScript have been marked deprecated.</p>

<h3 id="material-design"><a href="https://material.io/design/">Material Design</a></h3>

<p>Material Design is a set of design guidelines by Google. There are several Bootstrap implementations that uses these guidelines to give you an easy access to an implementation for these guidelines to use in your application. <a href="https://mdbootstrap.com/docs/jquery/components/demo/">Use this link for an overview of a few Bootstrap components with Material Design applied</a>. The provided link points to an implementation that has several implementations (free or paid) using JQuery, Angular, React and Vue.</p>

<h3 id="icon-sets">Icon sets</h3>

<p>When using one of the above design frameworks (or just using your own design) you may have need of some icon as visual aid for a user. The links below point to some icon sets that you could use. When using icons from different frameworks or sources be aware that, just like fonts, icons from a different set may have different line or edge shapes. Mixing and matching icons from different sets may break the feeling of consistency for your user. If you really need or want to use an icon from a different set that you are already using, consider changing al or al related current icons to the new set. By related icons I mean the ones whose functionality or concept is similar and are usually near each other on the page.</p>

<ul>
  <li><a href="https://fontawesome.com/">Font awesome icons</a></li>
  <li><a href="https://ionicons.com/">Ion icons</a></li>
</ul>

<h3 id="further-reading-and-research">Further reading and research</h3>

<p>The design frameworks in mentioned in this post adhere to certain style and UX (user-experience) guidelines to help you create nicer looking sites. Using these frameworks is good way of getting started but are not a sure way to create a good looking and usable site. Some links and resources to further content on what makes “good design” and “good user-experience” can be found listed below.</p>

<ul>
  <li><a href="https://www.uxbooth.com/articles/8-must-see-ux-diagrams/">Blogpost about 8 different UX diagrams</a>: The UX diagrams mentioned in this post are a good starting point for discovering some theories and guidelines for good UX.</li>
  <li><a href="https://www.amazon.com/dp/9490947725/ref=cm_sw_em_r_mt_dp_U_0KNtDb84VSDWY">The book Visual language</a>: This book is great read if your interested in how people perceive visual information. It also has some concrete guidelines and examples on how to design a website or magazine.</li>
  <li><a href="https://www.darkpatterns.org/types-of-dark-pattern">A website about Dark patterns</a>: This website contains a list of dark patterns for website design. Dark patterns are ways to fool or confuse a user and should be avoided.</li>
  <li><a href="https://userinyerface.com/">The userinyerface.com game</a>: As heard on the <a href="https://msdevshow.com/2019/07/graph-toolkit-with-nikola-metulev/">MS Dev Show episode talking about the Microsoft Graph web controls</a>. This game challenge you on with navigating through a form with a very bad design.</li>
</ul>

<p>And some links to podcast episodes about user interface/ user-experience design:</p>

<ul>
  <li><a href="https://www.codenewbie.org/podcast/why-you-should-understand-user-interface-and-design">CodeNewbie: Why you should understand user interface and design with Mina Markham</a></li>
  <li><a href="https://www.codenewbie.org/podcast/ux-in-healthcare">CodeNewbie: UX in healthcare with Danielle Smith</a></li>
  <li><a href="https://learntocodewith.me/podcast/product-design/">Learn to code with me: How to break into product design with Lenora Porter</a></li>
  <li><a href="https://dotnetrocks.com/?show=1618">DotNet Rocks: UX Design for Developers with Billy Hollis</a></li>
  <li><a href="https://dotnetrocks.com/?show=1643">DotNet Rocks: Integrating UX in your Development Process with Debbie Levitt</a></li>
  <li><a href="https://completedeveloperpodcast.com/episode-175/">Complete Developer Podcast: Dark Patterns in UI Design</a></li>
  <li><a href="https://hanselminutes.com/602/web-animation-at-work-with-rachel-nabors">Hanselminutes: Web Animation at Work with Rachel Nabors</a></li>
</ul>

        </div>
    </article>
    
    <article>
        <header class="article-header">
            <a href="/2019/06/22/Static-code-analysis-for-your-csharp-projects.html">Static code analysis for your C# projects</a>
        </header>
        
        <span>Jun 22, 2019</span> <br />
        Tags: 
        VisualStudio
        
        StaticCodeAnalysis
        
        <div class="article-content">
            <p>Static code analysis analyzes your source code or compiled dll files for certain patterns or filenames. There are several code analyzers available for C# in Visual Studio and/or Azure DevOps. These code analyzers improve consistency, prevent technical debt and prevent security issues.</p>

<p>The older Code Analysis features in Visual Studio (Analyze &gt; Run Code Analysis option) and Project properties (Code Analysis tab) are marked as deprecated and will not be covered in this post.</p>

<h3 id="visual-studio-built-in-analyzers">Visual Studio built in analyzers</h3>

<p>The Visual Studio compiler (Roslyn) already has some built in analyzer rules. When loading a project (like the <a href="https://github.com/dotnet-architecture/eShopOnWeb">eShopOnWeb</a> reference implementation) and opening a file, the analyzers installed in Visual Studio will analyze the file and show any error, warning or information message in the Visual Studio error list window.</p>

<p><img src="/assets/images/20190622/Default-style-messages.png" alt="[Default style messages]" /></p>

<p>By default Visual Studio will only contain some analyzers for code styling that output as information messages. You can edit the default code analyzer rules in the Visual Studio options via:</p>

<p>Tools &gt; Options &gt; Text Editor &gt; C# &gt; Code Style</p>

<p><img src="/assets/images/20190622/Default-style-messages-settings.png" alt="[Default style messages settings]" /></p>

<p>The severity of the ruleset can be changed in this options window:</p>

<p><img src="/assets/images/20190622/Default-style-messages-set-to-warning.png" alt="[Default style messages settings set severity]" /></p>

<p>By default it only analyzes the open file but you can enable solution wide analysis in the Visual Studio options to asynchronously analyze the entire solution. This option is found via:</p>

<p>Tools &gt; Options &gt; Text Editor &gt; C# &gt; Advanced &gt; Enable full solution analysis</p>

<p><img src="/assets/images/20190622/Enable-full-solution-analysis.png" alt="[Enable full solution analysis]" /></p>

<p>If you use Visual Studio 2019 and you have set rules resulting in errors or warning, you will also see a counter at the bottom of the file alerting you to issues in the files. There are also the colored squiggly lines in the text editor below the statement that may have and issue. There are colored blocks in the scrollbar of the text editor indicating where the issues are located in a file. And if you have the <a href="https://marketplace.visualstudio.com/items?itemName=VisualStudioPlatformTeam.ProductivityPowerPack2017">Productivity Power Tools</a> extension installed the Solution Error Visualization will show the same colored squiggly lines in the Solution Explorer window below filenames that have issues.</p>

<p>I have marked all visual indicators for errors and or warnings in the screenshot below:</p>

<p><img src="/assets/images/20190622/Visual-indicators-for-issues.png" alt="[Visual indicators for warnings or errors]" /></p>

<h3 id="sonarlint">SonarLint</h3>

<p>For extra code analysis I use the <a href="https://www.sonarlint.org/visualstudio/">SonarLint extension</a> in Visual Studio. This extension loads extra code analysis rules for several categories (code smells, bugs and security issues). For the full list see the <a href="https://rules.sonarsource.com/csharp">SonarSource rules pages</a>. Rules from SonarLint can be identified by the S prefix in the Error list window.</p>

<p><img src="/assets/images/20190622/SonarLint-messages.png" alt="[SonarLint warnings example]" /></p>

<p>You can use a .ruleset file in your project to disable or change the default severities or disable warnings for the default rules. See the <a href="https://docs.microsoft.com/en-us/visualstudio/code-quality/how-to-create-a-custom-rule-set">Microsoft Docs page for adding ruleset files</a> for more instructions.</p>

<p>When using SonarLint, I usually enable the category column in my error list window to triage the warnings shown. You can right click the error list window and use the option Show Columns &gt; Category to add it.</p>

<p><img src="/assets/images/20190622/Add-Category-column-to-error-list.png" alt="[Add Category column to error list]" /></p>

<h3 id="sonarqube">SonarQube</h3>

<p>The SonarLint extension also enables integration with a <a href="https://www.sonarqube.org/">SonarQube server</a>. SonarQube is open source static code analysis platform that can integrate <a href="https://www.sonarlint.org/visualstudio/#visualstudio-connected-mode">with Visual Studio</a> and <a href="https://www.azuredevopslabs.com/labs/vstsextend/sonarqube/">with Azure Devops</a>. SonarQube can be used to define a ruleset that all team members can download into new or existing projects. SonarQube (when integrating with Azure DevOps) can also provide code coverage metrics and code duplication analysis. It can also provide insight in the amount of issues over time and provides a technical debt score for a solution. You can also fail a build if your solution does not meet a configured quality gate. SonarQube is great in providing code analysis and related dashboards especially when working with a team on a code project. See the <a href="https://www.sonarqube.org/">SonarQube</a> website for all the features and installation instructions.</p>

<h3 id="security-code-scan">Security Code Scan</h3>

<p><a href="https://security-code-scan.github.io/">Security Code Scan</a> is a static analyzer extension focusing on security issues in your code. It checks for patterns that indicate SQL injection or XSS vulnerabilities in your code and several other issues that are defined by <a href="https://www.owasp.org/index.php/Main_Page">OWASP</a> as security issues.</p>

<p>After installing the extension (and enabling full solution wide analysis) the warnings from Security Code scan are listed with the prefix SCS.</p>

<p><img src="/assets/images/20190622/Security-Code-Scan-messages.png" alt="[Security Code Scan messages]" /></p>

<h3 id="auditnet">Audit.NET</h3>

<p><a href="https://github.com/OSSIndex/audit.net">Audit.NET</a> is an <a href="https://marketplace.visualstudio.com/items?itemName=VorSecurity.AuditNet">extension for Visual Studio</a> that scans you package.config file and compares the package references against several public databases containing known vulnerabilities. Any issues with packages are shown in the Error window as errors. These errors are not blocking and will not result prevent you from building, debugging or running your solutions.</p>

<p><img src="/assets/images/20190622/AuditNET-errors.png" alt="[Audit.NET messages]" /></p>

<p>At the time of this writing the extension can analyze .Net Core projects (and the new package references) but it does not seem to properly show the current issues in the error window.</p>

<h3 id="whitesource-bolt">WhiteSource Bolt</h3>

<p><a href="https://bolt.whitesourcesoftware.com/azure/">WhiteSoure Bolt</a> is the free version of WhiteSource and can be integrated <a href="https://www.azuredevopslabs.com/labs/vstsextend/whitesource/">with Azure Devops</a>. The free version can be used in an commercial environment but beware of the <a href="https://bolt.whitesourcesoftware.com/azure/terms/">terms of service</a> data and usage policies as it does send and store metadata and file hashes to WhiteSource hosted in America. This may be an issue in certain corporate environments (especially in Europe).</p>

<p>WhiteSource Bolt analyzes your project and will report on NuGet package of included dll files with known vulnerabilities. It will also give you an overview all used 3rd party components and their licenses.</p>

<p>See <a href="https://www.azuredevopslabs.com/labs/vstsextend/whitesource/">the Azure Devops labs last step of the Trigger a build section</a> for screenshots of the report for a build.</p>

        </div>
    </article>
    
    <article>
        <header class="article-header">
            <a href="/2019/05/06/Techniques-for-determining-test-scenarios.html">Techniques for determining test scenarios</a>
        </header>
        
        <span>May 6, 2019</span> <br />
        Tags: 
        Testing
        
        <div class="article-content">
            <p>Usually I think of test scenarios while examining specifications and writing code. Even though I am not a test first TDD practitioner and usually write and executing tests after writing some logic, I do think about and test scenarios throughout my coding  process.</p>

<p>The techniques I want to describe in this post have been helpful to me in writing better quality code. They help me catch missing requirements earlier and my eventual tests (manual or automated) are more complete. Knowing these techniques also helps me collaborate better with the QA team during development and/or testing.</p>

<p>The techniques may describe graphing out paths and making decision tables but I almost never write down the described graphs and tables. If you find yourself having trouble identifying or explaining scenarios, the described graph or table might help you as means of a visual aid.</p>

<p>The techniques are describe identifying all possible test scenarios for 100% coverage. Analyzing and testing all scenarios (manual or automatic) is usually not possible due to time constraints. You should always try to focus on the parts of the software that are most likely to fail due to complexity and the parts that have the highest cost to the business when they do fail. Your test set should be maintainable and provide good enough coverage so you have enough confidence in your test set. When in doubt collaborate with your team members or QA team to determine the value of a test scenarios and test coverage.</p>

<p>Testing techniques are divided into white and black box techniques. White box techniques look at the actual statements of the source code to determine test cases. Black box techniques use specifications to determine if outputs are correct when providing inputs.</p>

<h3 id="equivalence-class-and-boundary-partitioning-black-box-technique">Equivalence class and boundary partitioning (black box technique)</h3>

<p>Equivalence class partitioning is a technique for partitioning possible inputs into possible valid and invalid scenarios.</p>

<p>For string input for a certain field you could identify:</p>

<p>Valid input</p>
<ul>
  <li>Input length has minimum length of 0 (empty string) and maximum length of 50.</li>
  <li>Contains only alphanumeric characters and no diacritics.</li>
</ul>

<p>Invalid input</p>
<ul>
  <li>Null value.String larger than 50 characters.</li>
  <li>String with diacritics or other special characters (@# etcetera).</li>
</ul>

<p>The equivalence class technique states that you should create a test scenario for each of the valid and each of the invalid scenarios. If a method has multiple parameters and you are testing invalid scenarios you should never use more than one invalid input at a time to avoid defect masking.  This way you can relate expected errors back to the single invalid input or unexpected errors to one of the valid inputs.</p>

<p>Boundary partitioning is add on to equivalence class partitioning. You basically look at the equivalence classes and use the boundary value (for example string has length of 50), boundary value -1 (string length 49) and boundary value +1 (string length 51) as additional test cases. This technique is identifying the so called edge cases of input. You should look at all equivalence classes (valid and invalid) to determine if you can set up test cases with the boundary, boundary+1 and boundary-1, value between 2 boundaries and see if the outputs are the expected values.</p>

<h3 id="statement-and-decision-based-testing-white-box-techniques">Statement and decision based testing (white box techniques)</h3>

<p>Statement and decision based testing use a <a href="https://en.wikipedia.org/wiki/Control-flow_graph">control-flow graph</a>. Basically each node in the graph is a control statement where a decision is made about which path to execute next (so if, switch, while, for statements ). The branches (edges) of the graph are the possible code paths executed between the control statements.</p>

<p>Statement based testing creates test scenarios for each node (not all the edges). So you should have passed through each control statement (condition is true) at least once for coverage for this technique. When looking at the source code if you pass through each control statement and execute the code within the control statements, you should end up covering all lines in the source code.</p>

<p>Decision based testing looks to cover the edges of the control-flow graph. To cover all the edges of the graph you should create tests for each conditional state for the control statements. So for an if statement you should test with conditional false and true. For loops you should iterate at least through one loop and use a test case that ignores the loop. When using an switch/case statements all possible cases should be covered.</p>

<p>For some good examples of these two techniques, look at the short YouTube/Udacity links in the resource section of this post.</p>

<h3 id="conditional-based-testing-white-box-technique">Conditional based testing (white box technique)</h3>

<p>Control statements (for example if, switch, while, for statements ) usually have some kind of conditional logic. If the conditional logic has multiple inputs you can apply the rules for equivalence and boundary testing (see previous paragraph in this post) to determine all possible inputs to the conditional statement to see if the expected path is executed.</p>

<h3 id="state-transition-testing-black-box-technique">State transition testing (black box technique)</h3>

<p>Sometimes your software uses a <a href="https://en.wikipedia.org/wiki/Finite-state_machine">finite state machine</a> (maybe some kind of status table or status enum is used to describe the possible states of an object). The linked Wikipedia article for the finite state machine contains multiple techniques for identifying the states, path between states and the conditions per path or state.</p>

<p>Each path between a state is usually identifies a “happy flow” test scenario. Besides obvious valid state transitions you should try to identify invalid paths and if they are possible to execute in the system.</p>

<p>Also look at the conditions per path. See if you can use the rules for equivalence and boundary testing (see previous paragraph in this post) to determine if the guards work as expected.</p>

<h3 id="resources">Resources</h3>

<ul>
  <li><a href="https://www.istqb.org/downloads/send/51-ctfl2018/208-ctfl-2018-syllabus.html">ISTBQ: Foundation Level 2018 Syllabus (chapter 4 contains a list of testing techniques)</a></li>
  <li>Wikipedia:
    <ul>
      <li><a href="https://en.wikipedia.org/wiki/Equivalence_partitioning">Equivalence class partitioning</a></li>
      <li><a href="https://en.wikipedia.org/wiki/Boundary-value_analysis">Boundary value analysis</a></li>
      <li><a href="https://en.wikipedia.org/wiki/Control-flow_graph">Control-flow graph</a></li>
      <li><a href="https://en.wikipedia.org/wiki/Finite-state_machine">Finite state machine</a></li>
    </ul>
  </li>
  <li><a href="https://sqa.stackexchange.com/questions/20226/how-do-we-calculate-statement-coverage-branch-coverage-path-coverage-and-cond">StackExchange: How do we calculate Statement coverage, Branch coverage , Path coverage and Condition coverage in White box testing?</a></li>
  <li>YouTube/Udacity:
    <ul>
      <li><a href="https://www.youtube.com/watch?v=9PSrhH2gtkU">Statement Coverage - Georgia Tech - Software Development Process</a></li>
      <li><a href="https://www.youtube.com/watch?v=0lVA7TPpxUE">Control Flow Graphs - Georgia Tech - Software Development Process</a></li>
      <li><a href="https://www.youtube.com/watch?v=JkJFxPy08rk">Branch Coverage - Georgia Tech - Software Development Process</a></li>
      <li><a href="https://www.youtube.com/watch?v=ZnPmJd5aqyw">Condition Coverage - Georgia Tech - Software Development Process</a></li>
      <li><a href="https://www.youtube.com/watch?v=kd1_3CwYr60">Branch and Condition Coverage - Georgia Tech - Software Development Process</a></li>
    </ul>
  </li>
  <li><a href="https://www.softwaretestingclass.com/design-test-cases-using-state-transition-testing-technique/">Software Testing Class: How to Design Test Cases Using State Transition Testing Technique?</a></li>
  <li><a href="https://www.softwaretestingmaterial.com/state-transition-test-design-technique/">Software Testing Material: State Transition Test Case Design Technique</a></li>
</ul>


        </div>
    </article>
    
    <article>
        <header class="article-header">
            <a href="/2019/03/16/Securing-a-web-application-with-Azure-AD.html">Getting started with web application security using Azure Active Directory</a>
        </header>
        
        <span>Mar 16, 2019</span> <br />
        Tags: 
        WebAPI,
        
        Mvc
        
        <div class="article-content">
            <p>When developing enterprise applications on the internet you want to limit access to authenticated users only. In this blogpost I will provide links to some guides to help you get started with implementing secured websites and API using Azure Active Directory.</p>

<p>For more information on how the authentication methods provided by Azure Active Directory see the <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/authentication-scenarios">Microsoft Docs pages for Azure Active Directory authentication.</a></p>

<p>Also a great comprehensive resource around Azure Active Directory security is the <a href="https://app.pluralsight.com/library/courses/azure-active-directory-developers/table-of-contents">“Azure Active Directory for Developers” Pluralsight course</a>.</p>

<h3 id="azure-active-directory-security-for-a-user-using-a-browser-openid-connect">Azure Active Directory security for a user using a browser (OpenID Connect)</h3>

<p>When using Azure Active Directory for a user, the actual authentication process will happen outside of your application via the <a href="https://openid.net/connect/">OpenID Connect authentication scheme</a>. When an unauthenticated user uses a browser to navigate to your application, the middleware code will redirect the user to a Microsoft hosted login page. When the user provides the correct credentials, the login page will redirect the authenticated user back to a specified redirect URL in your application.</p>

<p>There are already great guides and sample application from Microsoft on how to get started with Azure Active Directory in your web applications.</p>

<p>For a guide on setting up OpenID Connect authentication for a .NET Framework application see the  <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/tutorial-v2-asp-webapp">“Add sign-in with Microsoft to an ASP.NET web app” guide on the Microsoft Docs pages.</a> or the <a href="https://azure.microsoft.com/en-us/resources/samples/active-directory-dotnet-webapp-openidconnect/">“Integrate Azure AD into a web application using OpenID Connect” Azure examples article.</a></p>

<p>For .NET Core see the <a href="https://docs.microsoft.com/en-us/aspnet/core/security/authentication/azure-active-directory/">“Azure Active Directory with ASP.NET Core” Microsoft Docs page</a> or the <a href="https://azure.microsoft.com/en-us/resources/samples/active-directory-dotnet-webapp-openidconnect-aspnetcore/">“Integrating Azure AD into an ASP.NET Core web app” Azure examples article</a>.</p>

<p>When using UI tests on a website that is secured with OpenID Connect you will also have to automate the login process. You will have to verify if a user lands on a login page and then use the automation framework to fill in a valid user name and password.</p>

<h3 id="azure-active-directory-security-between-applications-bearer-token-authentication">Azure Active Directory security between applications (Bearer token authentication)</h3>

<p>When another applications requests or posts data to your API, you will want to make sure that the API facing the public internet is secured so that only no unauthorized parties can use the API.</p>

<p>This security mechanism can leverage the Azure Active Directory via so called <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/access-tokens">access token</a>. The requesting party can request a token and send it in the Authorization header of the request to the API. The API application can verify the validity of the token against Azure Active Directory. If a token is valid the API can process the request and can use the caller identity and claims from the token available for further authorization logic.</p>

<p>For a guide on setting up bearer token authentication for a .NET Framework API application see the <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-v1-dotnet-webapi">“Build a .NET web API that integrates with Azure AD for authentication and authorization” quickstart on the Microsoft Docs pages.</a></p>

<p>For a guide on setting up bearer token authentication for a .NET Core API application see the <a href="https://devblogs.microsoft.com/aspnet/jwt-validation-and-authorization-in-asp-net-core/">“JWT Validation and Authorization in ASP.NET Core” guide on the Microsoft Docs pages</a>.</p>

<p>If the client application that consumes  the API is a .NET application, it will probably use the <a href="https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/wiki">ADAL</a> or <a href="https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/wiki">MSAL</a> client libraries to request a valid bearer token for the API. MSAL is currently still in preview.</p>

<p>If the current logged in user of the client application does not matter for the data retrieved or sent to the API, you can request a token for the client application without including any indication of the user that is logged into the client application. This will allow applications to be able to communicate securely without knowing about each others users or the privileges that the users have within a client application. This is called the “client credential” OAuth grant/flow. For more information on the flows/grants available in OAuth see the article <a href="https://auth0.com/docs/api-auth/which-oauth-flow-to-use">“Which OAuth flow to use”</a>.</p>

<p>For a guide on requesting a client credential flow token using ADAL see the <a href="https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/wiki/Client-credential-flows">“client credential flow” Github wiki page</a>.</p>

<p>For a guide on requesting a client credential flow token using MSAL see the <a href="https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/wiki/Client-credential-flows">“client credential flow” Github wiki page</a>.</p>

<p>If the client application is a non .NET application, it can request a token for the client application using the OAuth endpoints of Azure Active Directory via HTTP posts. See <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v1-oauth2-client-creds-grant-flow#service-to-service-access-token-request">the Microsoft docs pages for the HTTP requests to request an access token for an application</a>.</p>

<p>For testing an API with automated tests you can request a bearer token for the API with the same code as a client application and include the token in the Authorization header when calling the API under test.</p>

<h3 id="global-filters-to-ensure-all-requests-need-to-have-an-authenticated-user">Global filters to ensure all requests need to have an authenticated user</h3>

<p>After setting up authentication policies you will have to ensure that all requests require an authenticated user. This can be done by using the Authorize attribute on all (base) controllers but there are also global filters for .NET Framework or Authentication policies for .NET Core.</p>

<h4 id="global-filters-to-ensure-all-requests-need-to-have-an-authenticated-user-net-framework">Global filters to ensure all requests need to have an authenticated user (.NET Framework)</h4>

<p>To set up a global Authorization attribute in .NET Framework add the code below to the App_start/FilterConfig.cs file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class FilterConfig
{
    public static void RegisterGlobalFilters(GlobalFilterCollection filters)
    {
        filters.Add(new AuthorizeAttribute());
    }
}
</code></pre></div></div>
<p>The Authorize attributes for MVC and API Controllers reside in a different namespaces. If you decorate and API controller with the Authorize attribute for a MVC controller, the Authorize attribute will not be triggered. The MVC authorize attribute uses the “System.Web.Mvc” namespace. The API authorize attribute uses the “System.Web.Http” namespace.</p>

<p>If you have a project with both MVC and Web API controllers. You may want to configure the default OWIN Authentication pipeline to accept both OpenIDConnect and JwtBearerTokens but have certain API Controllers only use the JwtBearerToken authentication. You can deviate from the default OWIN Configuration by using the HostAuthenticationAttribute (System.Web.Http) on a controller or the SuppressHostPrincipal in the App_Start\WebApiConfig.cs file. You will need to install the NuGet package: “Microsoft.AspNet.WebApi.Owin” to access the classes.</p>

<p>Example for the global filter in the App_Start\WebApiConfig.cs:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>config.SuppressDefaultHostAuthentication();
config.Filters.Add(new HostAuthenticationFilter("Bearer"));
</code></pre></div></div>

<p>Example for the attribute on a specific controller::</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[HostAuthentication("Bearer")]
[Authorize]
public class MyApiController 
</code></pre></div></div>

<h4 id="global-filters-to-ensure-all-requests-need-to-have-an-authenticated-user-net-core">Global filters to ensure all requests need to have an authenticated user (.NET Core)</h4>

<p>To enable a global filters for all API and MVC controllers in .NET Core  you can use a Convention to set up an AuthorizationFilter on all controllers.</p>

<p>To implement the Convention, first add a new IControllerModelConvention implementation that will set the authorization policy for the controller. You could add extra conditional logic to not set the policy under certain conditions.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc.ApplicationModels;
using Microsoft.AspNetCore.Mvc.Authorization;

namespace NetCore.WebApiExample
{
    public class GlobalAuthorizeControllerModelConvention : IControllerModelConvention
    {
        public void Apply(ControllerModel controller)
        {
            var policy = new AuthorizationPolicyBuilder()
                .RequireAuthenticatedUser()
                .Build();

            controller.Filters.Add(new AuthorizeFilter(policy));
        }
    }
}
</code></pre></div></div>
<p>Next apply the convention in the Startup.cs file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void ConfigureServices(IServiceCollection services)
{
    //other code omitted
    //...

    services.AddMvc(options =&gt;
    {
        options.Conventions.Add(new GlobalAuthorizeControllerModelConvention());
    }).SetCompatibilityVersion(CompatibilityVersion.Version_2_1);
}
</code></pre></div></div>

<p>For more fine-grained authentication logic you could also implement a IActionModelConvention to conditionally apply the authorization policy per controller action.</p>

<p>To enable authentication for specific Razor Pages see <a href="https://docs.microsoft.com/en-us/aspnet/core/security/authorization/razor-pages-authorization">the Microsoft Docs pages on Razor Pages authorization conventions</a>.</p>

        </div>
    </article>
    
    <article>
        <header class="article-header">
            <a href="/2019/01/19/Web-API-versioning-using-the-NuGet-packages-from-Microsoft.html">Web API versioning using the NuGet packages from Microsoft</a>
        </header>
        
        <span>Jan 19, 2019</span> <br />
        Tags: 
        WebAPI
        
        <div class="article-content">
            <p>When developing a Web API, using versioning can greatly improve flexibility for production deployments. Even if the contract for your API changes, current users will not be impacted if you keep supporting the version they currently use. Using versioning will allow the consumers of your service more time to upgrade to newer versions and it will at the same time allow you to deploy on demand. At some point in time certain versions should of course be deprecated and finally removed to improve maintainability of the software.</p>

<p>Microsoft has several NuGet packages available to easily configure versioning in your API:</p>

<p><strong>NET core:</strong> <br />
Microsoft.AspNetCore.Mvc.Versioning<br />
Microsoft.AspNetCore.Mvc.Versioning.ApiExplorer</p>

<p><strong>NET framework:</strong><br />
Microsoft.AspNet.WebApi.Versioning<br />
Microsoft.AspNet. WebApi.Versioning.ApiExplorer</p>

<p>The ApiExplorer package is only needed when using the API metadata for each version (like for Swagger documentation).</p>

<p>In this blogpost I will describe how to enable versioning for your API including version support for the Swagger UI documentation. This blogpost will only describe these steps for a .NET Core projects. A complete solution with the code can be found in my <a href="https://github.com/SamanthaNeilen/WebApiExamples" title=" WebApiExamples GitHub repository ">WebApiExamples GitHub repository</a>. A .NET Framework example can be found on the <a href="https://github.com/Microsoft/aspnet-api-versioning/tree/master/samples/webapi/SwaggerWebApiSample" title="Microsoft.Asp.Net.WebApi.Versioning github repository for a sample project">Microsoft.Asp.Net.WebApi.Versioning github repository for a sample project</a>. The default Startup classes for the .NET Framework will need to be set up a little different from a project without versioning.</p>

<p>A small disclaimer: I will only show how to get started with versioning. When creating a new version, you should always think about support for previous versions or graceful degradation. Especially when you do database or schema changes. You must be careful not to break a previous version and may have to support multiple classes (or even database objects) with v1, v2 etcetera in their name or namespace if they are still used in a previous supported version. It is always a good idea when building an API to have integration tests. Having regression tests for the previous versions can ensure not breaking those versions while focusing on the new version.</p>

<p>The <a href="https://github.com/Microsoft/aspnet-api-versioning/wiki" title="Microsoft.Asp.Net.WebApi.Versioning github repository wiki">Microsoft.Asp.Net.WebApi.Versioning github repository wiki</a> contains all the documentation for the configuration and possibilities of the Microsoft.Asp.Net.WebApi.Versioning packages.</p>

<h3 id="minimal-configuration-for-versioning">Minimal configuration for versioning</h3>

<p>First install the NuGet package Microsoft.AspNetCore.Mvc.Versioning in your web project.</p>

<p>Next go to the Startup.cs file and add the code shown below to enable the default versioning by querystring.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//other code omitted</span>
    <span class="n">services</span><span class="p">.</span><span class="nf">AddApiVersioning</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">o</span><span class="p">.</span><span class="n">AssumeDefaultVersionWhenUnspecified</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="n">o</span><span class="p">.</span><span class="n">DefaultApiVersion</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ApiVersion</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="n">services</span><span class="p">.</span><span class="nf">AddMvc</span><span class="p">().</span><span class="nf">SetCompatibilityVersion</span><span class="p">(</span><span class="n">CompatibilityVersion</span><span class="p">.</span><span class="n">Version_2_1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This is all you need to enable versioning. The 2 options set in this snippet ensure that your current API will act as version 1.0 and that everyone that calls your service without a version querystring receives that version. (If you use Swagger documentation via Swashbuckle you will need extra configuration to ensure Swagger file generation keeps working. See the “Setup versioning for Swagger documentation using the Swashbuckle NuGet package” section later in this post.)</p>

<p>In my <a href="https://github.com/SamanthaNeilen/WebApiExamples" title=" WebApiExamples GitHub repository ">WebApiExamples GitHub repository</a> I have an API endpoint on the route <span class="link-style">https://localhost:44314/api/routingapi/123</span>. After adding the versioning configuration, this API is still available and responding to that address. Next I can call <span class="link-style">https://localhost:44314/api/routingapi/123?api-version=2.0</span>. Since I did not define a version 2.0 (at this point), I will receive the automatic error generated from the versioning package as shown below.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="s2">"error"</span><span class="p">:{</span><span class="s2">"code"</span><span class="p">:</span><span class="s2">"UnsupportedApiVersion"</span><span class="p">,</span><span class="s2">"message"</span><span class="p">:</span><span class="s2">"The HTTP resource that matches the request URI 'https://localhost:44314/api/routingapi/123' does not support the API version '2.0'."</span><span class="p">,</span><span class="s2">"innerError"</span><span class="p">:</span><span class="kc">null</span><span class="p">}}</span><span class="w">
</span></code></pre></div></div>

<p>I can now add a RouteApiV2Controller with a new interface to listen to the same url on V2. The code for the RouteApiController (that’s listening to version 1.0 or no ApiVersion specification) and RouteApiV2Controller are shown below.</p>

<p>RouteApiController:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Mvc</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">NetCore.WebApiExample.Controllers</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"api/[controller]"</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">ApiController</span><span class="p">]</span>
    <span class="p">[</span><span class="nf">ApiVersion</span><span class="p">(</span><span class="s">"1.0"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">RoutingApiController</span> <span class="p">:</span> <span class="n">ControllerBase</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
        <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"{email:Email}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Get</span><span class="p">(</span><span class="kt">string</span> <span class="n">email</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="s">$"Route is RoutingApiController.Get(</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">email</span><span class="p">)}</span><span class="s">) (DEFAULT VERSION)"</span><span class="p">);</span>
        <span class="p">}</span>        

        <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
        <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"{validPositiveInt32Value:range(0,2147483647)}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Get</span><span class="p">(</span><span class="kt">int</span> <span class="n">validPositiveInt32Value</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="s">$"Route is RoutingApiController.Get(</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">validPositiveInt32Value</span><span class="p">)}</span><span class="s"> (DEFAULT VERSION)"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
        <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"{inputMatchingRegex:regex(^(.+)(_)(.+)$)}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">GetByRegex</span><span class="p">(</span><span class="kt">string</span> <span class="n">inputMatchingtRegexForValueContainingUnderscore</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="s">$"Route is RoutingApiController.Get(</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">inputMatchingtRegexForValueContainingUnderscore</span><span class="p">)}</span><span class="s">) (DEFAULT VERSION)"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>RouteApiV2Controller:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Mvc</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">NetCore.WebApiExample.Controllers</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"api/RoutingApi"</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">ApiController</span><span class="p">]</span>
    <span class="p">[</span><span class="nf">ApiVersion</span><span class="p">(</span><span class="s">"2.0"</span><span class="p">)]</span>    
    <span class="k">public</span> <span class="k">class</span> <span class="nc">RoutingApiV2Controller</span> <span class="p">:</span> <span class="n">ControllerBase</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
        <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"{email:Email}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Get</span><span class="p">(</span><span class="kt">string</span> <span class="n">email</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="s">$"Route is RoutingApiController.Get(</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">email</span><span class="p">)}</span><span class="s">) (V2)"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
        <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"{validPositiveInt32Value:range(0,2147483647)}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Get</span><span class="p">(</span><span class="kt">int</span> <span class="n">validPositiveInt32Value</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="s">$"Route is RoutingApiController.Get(</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">validPositiveInt32Value</span><span class="p">)}</span><span class="s"> (V2)"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Notice that the V2 controller maps to the same path but is missing an endpoint.</p>

<p>When calling <span class="link-style">https://localhost:44314/api/routingapi/123</span> the service will return the default version. When calling <span class="link-style">https://localhost:44314/api/routingapi/123?api-version=2.0</span> it will execute and return the RouteApiV2Controller version.</p>

<p>When calling the missing method in v2 <span class="link-style">https://localhost:44314/api/routingapi/some_value?api-version=2.0</span> it will return the error shown below. When calling <span class="link-style">https://localhost:44314/api/routingapi/some_value</span> or <span class="link-style">https://localhost:44314/api/routingapi/some_value?api-version=1.0</span> it will just return the old method for version 1.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UnsupportedApiVersion"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The HTTP resource that matches the request URI 
            'https://localhost:44314/api/routingapi/some_value' does not support the API version '2.0'."</span><span class="p">,</span><span class="w">
        </span><span class="s2">"innerError"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="setup-versioning-for-swagger-documentation-using-the-swashbuckle-nuget-package">Setup versioning for Swagger documentation using the Swashbuckle NuGet package</h3>

<p>If you use Swagger UI via the Swashbuckle package as online documentation for your API you can set up descriptions per version. This will allow you to write release notes per versions and will give consumers documentation that represents actual the version the API that they currently use even if newer versions are available.</p>

<p>If you are using Swagger, the generation of the Swagger file will fail if routes are available for multiple versions and you have changed the configuration for Swagger to support multiple versions.</p>

<p>First install the Microsoft.AspNetCore.Mvc.Versioning.ApiExplorer NuGet package.</p>

<p>Next configure the Swagger configuration for versions in the ConfigureService method in the StartUp.cs as shown below to change the generation of a Swagger.json file per version.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// other code omitted 	</span>

    <span class="c1">// ConfigureSwagger(services) contains the services.AddSwaggerGen(options =&gt; {...}) code see method definition below</span>
    <span class="nf">ConfigureSwagger</span><span class="p">(</span><span class="n">services</span><span class="p">);</span>
 
    <span class="n">services</span><span class="p">.</span><span class="nf">AddApiVersioning</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
	        <span class="n">o</span><span class="p">.</span><span class="n">AssumeDefaultVersionWhenUnspecified</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
	        <span class="n">o</span><span class="p">.</span><span class="n">DefaultApiVersion</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ApiVersion</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
        <span class="p">});</span>

    <span class="n">services</span><span class="p">.</span><span class="nf">AddVersionedApiExplorer</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span> <span class="n">o</span><span class="p">.</span><span class="n">GroupNameFormat</span> <span class="p">=</span> <span class="s">"'V'VVV"</span><span class="p">);</span>
    <span class="n">services</span><span class="p">.</span><span class="nf">AddMvc</span><span class="p">().</span><span class="nf">SetCompatibilityVersion</span><span class="p">(</span><span class="n">CompatibilityVersion</span><span class="p">.</span><span class="n">Version_2_1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">ConfigureSwagger</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">services</span><span class="p">.</span><span class="nf">AddSwaggerGen</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">provider</span> <span class="p">=</span> <span class="n">services</span><span class="p">.</span><span class="nf">BuildServiceProvider</span><span class="p">()</span>
            <span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">IApiVersionDescriptionProvider</span><span class="p">&gt;();</span>
        
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">apiVersion</span> <span class="k">in</span> <span class="n">provider</span><span class="p">.</span><span class="n">ApiVersionDescriptions</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">ConfigureVersionedDescription</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">apiVersion</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">var</span> <span class="n">xmlCommentsPath</span> <span class="p">=</span> <span class="n">Assembly</span><span class="p">.</span><span class="nf">GetExecutingAssembly</span><span class="p">()</span>
            <span class="p">.</span><span class="n">Location</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s">"dll"</span><span class="p">,</span> <span class="s">"xml"</span><span class="p">);</span>
        <span class="n">options</span><span class="p">.</span><span class="nf">IncludeXmlComments</span><span class="p">(</span><span class="n">xmlCommentsPath</span><span class="p">);</span>

        <span class="n">options</span><span class="p">.</span><span class="n">OperationFilter</span><span class="p">&lt;</span><span class="n">SwaggerOperationFilter</span><span class="p">&gt;();</span>
        <span class="n">options</span><span class="p">.</span><span class="n">DocumentFilter</span><span class="p">&lt;</span><span class="n">SwaggerDocumentFilter</span><span class="p">&gt;();</span>
    <span class="p">});</span>
<span class="p">}</span>
        
<span class="k">private</span> <span class="k">void</span> <span class="nf">ConfigureVersionedDescription</span><span class="p">(</span><span class="n">SwaggerGenOptions</span> <span class="n">options</span><span class="p">,</span> <span class="n">ApiVersionDescription</span> <span class="n">apiVersion</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//In production code you should probably use a seperate class to get these version descriptions</span>
    <span class="kt">var</span> <span class="n">dictionairy</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> 
    <span class="p">{</span>
        <span class="p">{</span> <span class="s">"1.0"</span><span class="p">,</span> <span class="s">"This API features several endpoints showing different API features for API version V1"</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s">"2.0"</span><span class="p">,</span> <span class="s">"This API features several endpoints showing different API features for API version V2"</span> <span class="p">}</span>
    <span class="p">};</span>

    <span class="kt">var</span> <span class="n">apiVersionName</span> <span class="p">=</span> <span class="n">apiVersion</span><span class="p">.</span><span class="n">ApiVersion</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
    <span class="n">options</span><span class="p">.</span><span class="nf">SwaggerDoc</span><span class="p">(</span><span class="n">apiVersion</span><span class="p">.</span><span class="n">GroupName</span><span class="p">,</span>
        <span class="k">new</span> <span class="nf">Info</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Title</span> <span class="p">=</span> <span class="s">"NetCore.WebApiExample"</span><span class="p">,</span>
            <span class="n">Version</span> <span class="p">=</span> <span class="n">apiVersionName</span><span class="p">,</span>
            <span class="n">Description</span> <span class="p">=</span> <span class="n">dictionairy</span><span class="p">[</span><span class="n">apiVersionName</span><span class="p">]</span> 
        <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Finally change the Configure method as shown below to enable the version selection in Swagger UI.(Notice the IApiVersionDescriptionProvider provider parameter is added to the method signature.)</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">IApplicationBuilder</span> <span class="n">app</span><span class="p">,</span> <span class="n">IHostingEnvironment</span> <span class="n">env</span><span class="p">,</span> <span class="n">IApiVersionDescriptionProvider</span> <span class="n">provider</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// other code omitted </span>

    <span class="n">app</span><span class="p">.</span><span class="nf">UseSwagger</span><span class="p">();</span>

    <span class="n">app</span><span class="p">.</span><span class="nf">UseSwaggerUI</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">apiVersion</span> <span class="k">in</span> <span class="n">provider</span><span class="p">.</span><span class="n">ApiVersionDescriptions</span>
                 <span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">version</span> <span class="p">=&gt;</span> <span class="n">version</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()))</span>
        <span class="p">{</span>
            <span class="n">c</span><span class="p">.</span><span class="nf">SwaggerEndpoint</span><span class="p">(</span>
                <span class="s">$"/swagger/</span><span class="p">{</span><span class="n">apiVersion</span><span class="p">.</span><span class="n">GroupName</span><span class="p">}</span><span class="s">/swagger.json"</span><span class="p">,</span>
                    <span class="s">$"NetCore.WebApiExample </span><span class="p">{</span><span class="n">apiVersion</span><span class="p">.</span><span class="n">GroupName</span><span class="p">}</span><span class="s">"</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="n">app</span><span class="p">.</span><span class="nf">UseMvc</span><span class="p">(</span><span class="n">routes</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">routes</span><span class="p">.</span><span class="nf">MapRoute</span><span class="p">(</span>
            <span class="n">name</span><span class="p">:</span> <span class="s">"default"</span><span class="p">,</span>
            <span class="n">template</span><span class="p">:</span> <span class="s">"{controller=Home}/{action=Index}/{id?}"</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>After this configuration the Swagger UI will have the different versions available in the dropdown to the left. Also notice that the version 2 will only contain the routes and models defined for version 2.</p>

<p>When versioning is enabled the api-version query parameter input field will be automatically added to all methods in Swagger UI.</p>

<p>Swagger UI for version 1:</p>

<p><img src="/assets/images/20190119/SwaggerUIWebAPIV1.png" alt="[Swagger UI API Version 1]" /></p>

<p>Swagger UI for version 2:</p>

<p><img src="/assets/images/20190119/SwaggerUIWebAPIV2.png" alt="[Swagger UI API Version 2]" /></p>

<p>If you use document or operation filters (as explained in <a href="https://samanthaneilen.github.io/2018/12/08/Using-and-extending-swagger.json-for-API-documentation.html" title="my blogpost regarding Swagger/OpenApi/Swashbuckle constraints">my previous post</a>) you may get some unintended behavior when they are executed based on strings and names that overlap over versions.</p>

<p>For example look at the document filter below:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Swashbuckle.AspNetCore.Swagger</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Swashbuckle.AspNetCore.SwaggerGen</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">NetCore.WebApiExample.MiddleWare.Swagger</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SwaggerDocumentFilter</span> <span class="p">:</span> <span class="n">IDocumentFilter</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Tag</span><span class="p">&gt;</span> <span class="n">_tags</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Tag</span><span class="p">&gt;</span>
        <span class="p">{</span>
            <span class="k">new</span> <span class="n">Tag</span> <span class="p">{</span> 
            	<span class="n">Name</span> <span class="p">=</span> <span class="s">"RoutingApi"</span><span class="p">,</span> 
            	<span class="n">Description</span> <span class="p">=</span> <span class="s">"This is a description for the api routes"</span> 
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Apply</span><span class="p">(</span><span class="n">SwaggerDocument</span> <span class="n">swaggerDoc</span><span class="p">,</span> <span class="n">DocumentFilterContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">swaggerDoc</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentNullException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">swaggerDoc</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">swaggerDoc</span><span class="p">.</span><span class="n">Tags</span> <span class="p">=</span> <span class="nf">GetFilteredTagDefinitions</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
            <span class="n">swaggerDoc</span><span class="p">.</span><span class="n">Paths</span> <span class="p">=</span> <span class="nf">GetSortedPaths</span><span class="p">(</span><span class="n">swaggerDoc</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Tag</span><span class="p">&gt;</span> <span class="nf">GetFilteredTagDefinitions</span><span class="p">(</span><span class="n">DocumentFilterContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//Filtering ensures route for tag is present</span>
            <span class="kt">var</span> <span class="n">currentGroupNames</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">ApiDescriptions</span>
            	<span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">description</span> <span class="p">=&gt;</span> <span class="n">description</span><span class="p">.</span><span class="n">GroupName</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">_tags</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">tag</span> <span class="p">=&gt;</span> <span class="n">currentGroupNames</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">tag</span><span class="p">.</span><span class="n">Name</span><span class="p">)).</span><span class="nf">ToList</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">IDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">PathItem</span><span class="p">&gt;</span> <span class="nf">GetSortedPaths</span><span class="p">(</span>
        	<span class="n">SwaggerDocument</span> <span class="n">swaggerDoc</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">swaggerDoc</span><span class="p">.</span><span class="n">Paths</span><span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">pair</span> <span class="p">=&gt;</span> <span class="n">pair</span><span class="p">.</span><span class="n">Key</span><span class="p">)</span>
            	<span class="p">.</span><span class="nf">ToDictionary</span><span class="p">(</span><span class="n">pair</span> <span class="p">=&gt;</span> <span class="n">pair</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">pair</span> <span class="p">=&gt;</span> <span class="n">pair</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The Tag list contains a hardcoded name here that is not present when switching to version 2 of the API (see the screenshots of Swagger UI earlier in the post). If you do not use the context.ApiDescriptions to check there are routes for the group it will end up adding an empty group for version 2. If I did not add the filtering the Swagger UI page for version 2 would have looked as shown in the screenshot below.</p>

<p><img src="/assets/images/20190119/SwaggerUIEmptyTag.png" alt="[Swagger UI with empty Tag]" /></p>

<h3 id="resources">Resources</h3>

<p>For more information on all the features and configuration of the versioning packages visit the link below.</p>

<p><a href="https://github.com/Microsoft/aspnet-api-versioning/wiki" title="Microsoft.Asp.Net.WebApi.Versioning github repository wiki">Microsoft.Asp.Net.WebApi.Versioning github repository wiki</a></p>


        </div>
    </article>
    
    <center><p><a href="/archive">For additional posts see the archive page for an overview of all available posts</a></p></center>
    
</div>

                </main>
            </div>
            <div class="col-md-3">
                <aside aria-label="sidebar">
                    <section class="sidebar-section">
    <h3>About me</h3>
    I am a dutch .Net developer.
    I have been coding professionaly since 2008.
    On this blog I will be writing about multiple subjects that I use in my daily programming job or subjects that I am studying.
</section>
<section class="sidebar-section">
    <h3>Social</h3>
    <a href="https://github.com/SamanthaNeilen"><i class="fa fa-github" aria-hidden="true"></i><span>&nbsp;SamanthaNeilen</span></a> <br />
    <a href="https://twitter.com/NeilenSamantha"><i class="fa fa-twitter" aria-hidden="true"></i><span>&nbsp;NeilenSamantha</span></a> <br />
    <a href="https://www.linkedin.com/in/samantha-neilen-16153713"><i class="fa fa-linkedin" aria-hidden="true"></i><span>&nbsp;Samantha Neilen</span></a><br />
    Subscribe via <a href="/feed.xml">RSS</a>
</section>
<section class="sidebar-section">
    <h3>Last posts </h3>
    
    <a href="/2019/08/10/Front-end-design.html">Front-end design</a> <br />
    <div class="last-posts-spacer"></div>
    
    <a href="/2019/06/22/Static-code-analysis-for-your-csharp-projects.html">Static code analysis for your C# projects</a> <br />
    <div class="last-posts-spacer"></div>
    
    <a href="/2019/05/06/Techniques-for-determining-test-scenarios.html">Techniques for determining test scenarios</a> <br />
    <div class="last-posts-spacer"></div>
    
    <a href="/2019/03/16/Securing-a-web-application-with-Azure-AD.html">Getting started with web application security using Azure Active Directory</a> <br />
    <div class="last-posts-spacer"></div>
    
    <a href="/2019/01/19/Web-API-versioning-using-the-NuGet-packages-from-Microsoft.html">Web API versioning using the NuGet packages from Microsoft</a> <br />
    <div class="last-posts-spacer"></div>
    
    <a href="/archive">Archive</a>
</section>
                </aside>
            </div>
        </div>
    </div>
</body>
</html>
